/*! Email Tracker uses the popular InboxSDK library (www.inboxsdk.com). InboxSDK is used by several large organizations:
*   Dropbox (https://chrome.google.com/webstore/detail/dropbox-for-gmail-beta/dpdmhfocilnekecfjgimjdeckachfbec)
*   HubSpot (https://chrome.google.com/webstore/detail/hubspot-sales/oiiaigjnkhngdbnoookogelabohpglmd)
*   Stripe (https://chrome.google.com/webstore/detail/stripe-for-gmail/dhnddbohjigcdbcfjdngilgkdcbjjhna)
*   Giphy (https://chrome.google.com/webstore/detail/giphy-for-gmail/andgibkjiikabclfdkecpmdkfanpdapf)
*   Clearbit (https://chrome.google.com/webstore/detail/clearbit-connect-supercha/pmnhcgfcafcnkbengdcanjablaabjplo)
* The use of the library is similar to using other popular javascript libraries like jQuery and Underscore
*
* The library allows us to load our application code from our server providing our users with fast updates and the ability quickly respond to bugs.
*/function Disconnected(){window.DISCONNECTED||(window.DISCONNECTED=1,window.emailtracker_elements.forEach(function(e){e.removeAttribute("data-emailtracker"),e.removeAttribute("emailtracker")}),document.querySelectorAll(".emailtracker,.emailtracker_thread_loaded,[data-emailtracker],[emailtracker]").forEach(function(e){e.removeAttribute("data-emailtracker"),e.classList.remove("emailtracker"),e.classList.remove("emailtracker_thread_loaded"),e.removeAttribute("emailtracker")}),document.querySelectorAll(".emailtracker_status").forEach(function(e){Xtion_elements_delete(e)}),document.documentElement.removeAttribute("data-emailtracker-initialized"))}window.emailtracker_elements=[],window.CONTENT=1,window.ENABLED=1,document.documentElement.setAttribute("data-emailtracker-initialized","1"),window.ACTIVATED=0,window.DISCONNECTED=0;var heartbeat_port=chrome.runtime.connect({name:"heartbeat_port"}),parse_response,google_inbox_url,inbox_index,state_load;function Tracker(e,o,r){(r=r||{}).interval=r.interval||1e3;var t=0,n=setInterval(function(){t++;try{e(function(i){!window.emailtracker_ini&&Email_valid(i)&&(window.emailtracker_ini=1,clearInterval(n),Storage_get("cache_emails",function(a){function t(n){var e,t=[];for(e in a)t.push(a[e]);Background_storage_set("email_ids",JSON.stringify(t)),Background_cookie_set("user",n,(new Date).getTime()/1e3+31536e3,function(){chrome.runtime.sendMessage({a:"activated"}),window.ACTIVATED=1;function e(){DISCONNECTED||(Background_storage_set("user",n),Background_cookie_set("user",n,(new Date).getTime()/1e3+31536e3),LOCATION_TRACKERS.forEach(function(e,t){0!=t&&Background_cookie_set("user",n,(new Date).getTime()/1e3+31536e3,null,{url:e})}),Background_cookie_set("user",n,(new Date).getTime()/1e3+31536e3,null,{url:"http://bitt.site"}),Background_cookie_set("user",n,(new Date).getTime()/1e3+31536e3,null,{url:"http://bitli.pro"}))}e(),window.addEventListener("focus",e),setInterval(function(){window.DISCONNECTED||Storage_get("cache_email_"+n+"_aliases",function(e){var a=[n],e=(e&&e.length&&a.concat(Object.values(e)),JSON.stringify(e));window.emailtracker_css_rules_hide_own_trackers!=e&&(window.emailtracker_css_rules_hide_own_trackers=e,Css_rule(window.LOCATION_TRACKERS_V.map(function(t){var n=[];return a.forEach(function(e){n.push('img[src*="'+t+"?u="+e+'"]')}),n.join(",")}).join(",")+"{display:none;}")),document.querySelectorAll(window.LOCATION_TRACKERS_V.map(function(e){return'img[src*="'+e+'?u"]'}).join(",")).forEach(function(t){a.forEach(function(e){t.src.indexOf("?u="+n+"&")}),0===t.naturalWidth&&t.naturalHeight})})},1e3),setInterval(function(){window.DISCONNECTED||o(n,i)},r.interval)})}(a=a||{})[i]&&!isNaN(a[i])?t(a[i]):Request_background(LOCATION_ACTION+"user?e="+encodeURIComponent(i),function(e){e&&(a[i]=e,Storage_update("cache_emails",a,function(){t(e)}))})}))})}catch(e){}30<t&&(DISCONNECTED||clearInterval(n))},500)}function Tracker_email_alias_id(o,r,c){Storage_get("cache_emails",function(i){i=i||{},Storage_get("cache_email_"+o+"_aliases",function(a){a=a||{};function t(e){var t,n=[];for(t in i)n.push(i[t]);Background_storage_set("email_ids",JSON.stringify(n)),a[r]||(a[r]=e,Storage_update("cache_email_"+o+"_aliases",a)),c&&c(e)}i[r]&&!isNaN(i[r])?t(i[r]):Request_background(LOCATION_ACTION+"user?e="+encodeURIComponent(r),function(e){e&&(i[r]=e,Storage_update("cache_emails",i,function(){t(e)}))})})})}function Tracker_send(e,t){t&&window.emailtracker_elements.push(t),window.DISCONNECTED||1==window.ENABLED&&e()}function Tracker_insert(c,s,e,d,l,u){var _,m,p;u=u||{},s&&e?(_=function(){setTimeout(function(){e.setAttribute("data-emailtracker_loaded","1"),e.click(),e.removeAttribute("data-emailtracker_loaded")},0)},m=0,u.popup_loading_disable||Xtion_popup_loading({message:"Email Tracker Loading",cancel:function(){m=1,_(),Xtion_popup_close()}}),p=function(){u.popup_loading_disable||Xtion_popup_close()},Storage_get("settings",function(r){r=r||{},Storage_get("notify",function(t){Storage_get("tracking_links_disabled",function(o){Storage_get("tracking_disabled",function(e){e?(m=1,p(),_()):Request_background(LOCATION_ACTION+"email?id_user="+parseInt(c)+(t?"&notify="+parseInt(t.id)+"&notify_v="+encodeURIComponent(t.v):""),function(t){if(!m)try{var e,n,a,i=JSON.parse(t);Tracker_remove_previous(s,u.remove_previous_blank_src),s.insertAdjacentHTML("beforeend",'<img src="'+LOCATION_TRACKER_V+"?u="+(u.uid_alias||c)+"&e="+i.id+"&v="+i.v+'" alt="" width="0" height="0" style="width:2px;max-height:0;overflow:hidden"/>'+(r.tracking_pixels||"")),i.pro&&!o&&(u.remove_previous_blank_src?Element_textnodes(s).forEach(function(e){if(e.nodeValue){for(var t=0,n=e.parentNode;!t&&n;)"A"===n.tagName&&(t=1),n=n.parentNode;e.innerHTML=Autolinker.link(e.nodeValue,{stripPrefix:!1,email:!1,phone:!1,twitter:!1,mention:!1,hashtag:!1,stripTrailingSlash:!1,decodePercentEncoding:!1})}}):s.innerHTML=Autolinker.link(s.innerHTML,{stripPrefix:!1,email:!1,phone:!1,twitter:!1,mention:!1,hashtag:!1,stripTrailingSlash:!1,decodePercentEncoding:!1}),e=Array.prototype.slice.call(s.querySelectorAll("a")),n=[],a=[],e.forEach(function(e){e.getAttribute("href")&&0===e.href.indexOf("http://bitt.site/")&&(e.href=e.href.replace("http://bitt.site/","https://bitli.pro/")),e.getAttribute("href")&&""!==e.getAttribute("href")&&0!==e.href.indexOf("mailto:")&&0!==e.href.indexOf("tel:")&&(a.push(e),n.push(e.href))}),n.length)?Request_background(LOCATION_ACTION+"email_links",function(t){if(!m){try{JSON.parse(t).forEach(function(e,t){a[t].href=e})}catch(e){Error_popup(102,"Link Tracking Error: "+e,t)}p(),l||_(),d(i,m),l&&_()}},{post:Xtion_object_merge(i,{links:n}),timeout:1e4,retry:3,error:function(e){p(),_(),Error_popup(103,"Link Tracker Server Connection Error: "+e)}}):(p(),l||_(),d(i,m),l&&_())}catch(e){p(),_(),Error_popup(100,e,JSON.stringify(e.stack)+" "+t)}},{timeout:1e4,retry:3,error:function(e){p(),_(),Error_popup(101,"Email Tracker Server Connection Error: "+e)}})})})})})):Error_popup(110,"Unknown Edge Case - Please Contact Us For a Fix",document.body.innerHTML)}function Tracker_remove_previous(e,t){Xtion_foreach(e.querySelectorAll(window.LOCATION_TRACKERS.map(function(e){return'img[src*="'+e+'"]'}).join(",")),function(e){t?e.removeAttribute("src"):Xtion_elements_delete(e)})}function Tracker_icon(e,t){t=t||{};function c(){document.querySelectorAll(".emailtracker_status.emailtracker_show").forEach(function(e){Xtion_elements_delete(e)})}function s(n,i,o){c();var r="emailtracker_show"+Uniqid(),e=document.createElement("div");e.className="emailtracker_status emailtracker_show",e.id=r,e.innerHTML=n.lastChild.outerHTML,document.body.appendChild(e),setTimeout(function(){var a,e,t=document.getElementById(r);t&&((a=t.firstChild).addEventListener("mouseleave",function(){c()}),a.addEventListener("mousemove",function(){this.setAttribute("data-focused","1")}),a.style.opacity=1,a.style.top=i.clientY+"px",a.style.left=i.clientX+"px",a.style.marginLeft=i.clientX+a.clientWidth>window.innerWidth?15-a.clientWidth+"px":"-15px",a.style.marginTop=i.clientY+a.clientHeight>window.innerHeight?10-a.clientHeight+"px":"-10px",Math.abs(a.style.marginTop.replace("px",""))>a.style.top.replace("px","")&&(a.style.marginTop="-"+a.style.top),o&&((e=t.querySelector(".emailtracker_status_unread"))&&(e.onclick=function(){confirm("Are you sure you want to mark this email tracker as unread? This is used for false positives or notification of the next view.")&&(Request_background(LOCATION_ACTION+"email_unread?id_source="+encodeURIComponent(o)),n.innerHTML="&#9679;",c())}),e=t.querySelector(".emailtracker_status_print"))&&(e.onclick=function(){window.open(LOCATION_MAIN+"user/email_report.php?id_source="+encodeURIComponent(o))}),setTimeout(function(){var n=function(e){if(window.removeEventListener("mousemove",n),!a.getAttribute("data-focused")){for(var t=e.target;t.parentNode;){if(t===a)return;t=t.parentNode}c()}};window.addEventListener("mousemove",n)},500))},50)}var n=setInterval(function(){var r=document.getElementById(e.id_source);r&&(clearInterval(n),r.setAttribute("data-id",r.id),r.id="",r.addEventListener("mouseenter",function(n){var o=this.lastChild;s(r,n,this.getAttribute("data-id")),setTimeout(function(){var i;o.getAttribute("data-emailtracker")||(o.setAttribute("data-emailtracker","1"),"1"===r.getAttribute("data-status")&&(i=o.parentNode.getAttribute("data-id"),Request_background(LOCATION_ACTION+"email_views?id_source="+encodeURIComponent(i),function(a){var e;a?(a=JSON.parse(a),Storage_get("settings",function(e){e=e||{},a instanceof Array?o.innerHTML="<span><strong><span data-emailtracker-onclick=\"if(event.detail===4){prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(i)+"')}\">"+a.length+" View"+(1===a.length?"":"s")+" / Click"+(1===a.length?"":"s")+'</span> <a href="javascript:" class="emailtracker_status_print">&nbsp; | Print</a> <a href="javascript:" class="emailtracker_status_unread">Mark Unread</a></strong>'+Tracker_parse_email_views(a,e)+"</span>":o.innerHTML="<span style=\"text-align:center;font-weight:700\"><span data-emailtracker-onclick=\"if(event.detail===4){prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(i)+"')}\">"+a.views+" view"+(1==a.views?"":"s, last seen")+"</span> <time>"+Moment_date_pretty(moment.unix(a.last))+'</time><br/><a href="'+LOCATION_MAIN+'pro?source=inbox_read_report" target="_blank"><img alt="Upgrade to Pro to see the full Read Report" src="'+chrome.extension.getURL("image/upgrade.jpg")+'"/></a></span>';function t(e){e.stopPropagation()}o.addEventListener("click",t,!1),o.addEventListener("mousedown",t,!1),o.addEventListener("dblclick",t,!1),o.addEventListener("contextmenu",t,!1),s(r,n,o.parentNode.getAttribute("data-id")),setTimeout(function(){Storage_get(["feed","feed_unopened"],function(n){var t=a.views||a.length;n.feed=n.feed.filter(function(e){return e}),n.feed_unopened=n.feed_unopened.filter(function(e){return e}),(n.feed_unopened||[]).forEach(function(e,t){n.feed_unopened[t].unopened=1,n.feed_unopened[t].unopened_key=t}),(n.feed||[]).concat(n.feed_unopened||[]).forEach(function(e){e&&e.id_source===i&&e.views!=t&&(e.views=t,e.time=a.last||a[0].timestamp,e.unopened&&(n.feed_unopened.splice(e.unopened_key,1),Storage_update("feed_unopened",n.feed_unopened),delete e.unopened,delete e.unopened_key,n.feed.push(e)),Storage_update("feed",n.feed))})})},0)})):(o.innerHTML="<span>Error. Please contact us for help.</span>",o.addEventListener("click",e=function(e){e.stopPropagation()},!1),o.addEventListener("mousedown",e,!1),o.addEventListener("dblclick",e,!1),o.addEventListener("contextmenu",e,!1),s(r,n,o.parentNode.getAttribute("data-id")))})))},100)}))},500);return window.emailtracker_inline_events||(window.emailtracker_inline_events=setInterval(function(){document.querySelectorAll("[data-emailtracker-onclick]").forEach(function(e){e.onclick||(e.onclick=new Function(e.getAttribute("data-emailtracker-onclick")))})},500)),"<"+(t.tag||"span")+' data-status="'+parseInt(e.status)+'" id="'+e.id_source+'"'+(t.style?' style="'+t.style+'"':"")+(t.attributes?" "+t.attributes:"")+' class="emailtracker_status'+(t.class?" "+t.class:"")+'">'+(1==e.status?"&#10003;":"&#9679;")+(1==e.status?'<span style="display:none"><span><img alt="Loading.." src="'+chrome.extension.getURL("image/loading.gif")+'"/></span></span>'+(t.tag?"</"+t.tag+">":"</span>")+"</span>":'<span style="display:none" data-emailtracker-onclick="event.stopPropagation()"><span style="padding:15px;text-align:center;"><strong data-emailtracker-onclick="if(event.detail===4){prompt(\'Copy the email debug information below and send to us when necessary:\',\''+Xtion_html_special_chars(e.id_source)+'\')}">Email Tracker Not Yet Read</strong><p style="width:400px;margin: 10px 0!important;white-space:normal;">Refresh the page to get updated tracking statuses. If the recipients email client blocks images the tracking will not be able to detect if the recipient opened the email.'+(~location.href.indexOf("mail.google.com")?"":" If you open your own email with email tracker it will not become read, to test the extension send to another email account.")+'</p><a href="'+LOCATION_MAIN+'help" target="_blank">click here for more details &amp; help</a></span></span>'+(t.tag?"</"+t.tag+">":"</span>"))}function Tracker_feed_info_insert(t,e,n,a,i,o,r){Storage_get("feed_info",function(e){(e=e||{})[a]={email:n,id:t.id,subject:i,link:o,to:r,timestamp:(new Date).getTime()/1e3},Storage_update("feed_info",e)}),Storage_get("feed_unopened",function(e){(e=e||[]).push({id:t.id,id_source:a,user:n}),Storage_update("feed_unopened",e)}),t.pro&&Request_background(LOCATION_ACTION+"email_information",null,{post:{id:t.id,v:t.v,uid:e,email:n,subject:i,link:o,to:r.join(", ")}})}heartbeat_port.onDisconnect.addListener(function(){Disconnected()}),window.emailtracker_untracked_emails=[],~window.location.host.indexOf("mail.live.com")?(Tracker(function(e){e(document.querySelector('span[title*="@"]').title)},function(o,r){function t(e){Tracker_insert(o,document.getElementById("ComposeRteEditor_surface").contentWindow.document.body,e,function(t,n){document.getElementById("CancelMessage").addEventListener("click",function(){n=1},!0),document.addEventListener("keydown",function(e){27===e.keyCode&&(n=1)},!0);var a=document.getElementsByName("fSubject").length?document.getElementsByName("fSubject")[0].value:"",i=[],e=(document.querySelectorAll(".To .cp_Contact").forEach(function(e){var e=e.textContent.replace(/"/g,"").replace(/;/g,"").trim(),t=e.split(" ",2);"<"+t[0]+">"===t[1]&&(e=t[0]),i.push(e)}),setInterval(function(){null===document.getElementById("ComposeRteEditor_surface").offsetParent&&(clearInterval(e),n||Xtion_request("https://mail.live.com/?fid=flsent",function(e){e=(new DOMParser).parseFromString(e,"text/html").querySelector(".mailList").firstElementChild.id;Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(t,{id_source:"0_"+e})}),Tracker_feed_info_insert(t,o,r,"0_"+e,a||"(no subject)",window.location.href.split("?")[0].split("#")[0]+"?tid="+encodeURIComponent("cm"+e.substring(2)),i)}))},100))})}function e(e){Tracker_send(function(){~window.location.href.indexOf("Compose")&&(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),t(document.getElementById("SendMessage")))})}window.emailtracker_keydown||(window.emailtracker_keydown=1,window.addEventListener("keydown",e,!0));var n=top.document.getElementById("ComposeRteEditor_surface"),a=(n&&!n.getAttribute("data-emailtracker")&&(n.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(n),n.contentWindow.addEventListener("keydown",e,!0)),(n=document.getElementById("SendMessage"))&&!n.getAttribute("data-emailtracker")&&(n.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(n),n.addEventListener("click",function(e){Tracker_send(function(){n.getAttribute("data-emailtracker_loaded")||(e.stopPropagation(),e.preventDefault(),t(n))},n)})),[]),i=(document.querySelectorAll(".c-MessageRow").forEach(function(e){e.getAttribute("data-emailtracker")||(e.setAttribute("data-emailtracker","1"),a.push("0_"+e.id))}),a.length&&Request_background(LOCATION_ACTION+"emails?client=outlook_mail",function(e){JSON.parse(e).forEach(function(e){document.querySelector(".mailListPane.Narrow")?document.getElementById(e.id_source.replace("0_","")).querySelector("[id*=instantActionsControl]").parentNode.innerHTML+=Tracker_icon(e,{tag:"div",style:"display:inline-block;"}):document.getElementById(e.id_source.replace("0_","")).lastElementChild.previousElementSibling.lastElementChild.insertAdjacentHTML("afterBegin",Tracker_icon(e,{tag:"div",style:"display:inline-block;"}))})},{post:{emails:a}}),document.getElementById("ComposeRteEditor_surface"));i&&Css_rule(window.LOCATION_TRACKERS_V.map(function(e){return'img[src*="'+e+"?u="+o+'"]'}).join(",")+"{display:none;}",0,i.contentWindow.document)}),document.documentElement.classList.add("emailtracker_outlook")):~window.location.host.indexOf("mail.google.com")?(Script_inject(chrome.extension.getURL("lib/gmail.js")),parse_response=function(e){var t=[];return e.split("\n").forEach(function(e){if(e=e.trim())try{t.push(new Function('"use strict"; return '+e.trim())())}catch(e){}}),t},Tracker(function(t){Variable("GLOBALS",function(e){e?t(e[10]):Variable("(window.gbar?window.gbar._CONFIG[0][10]:null)",function(e){e&&t(e[5])})})},function(f,g){Variable("GM_SPT_ENABLED",function(e){e="true"===e,Variable("GM_RFT_ENABLED",function(s){var c,d,n;s="true"===s,window.emailtracker_uid=f,window.emailtracker_email=g,DEBUG&&Storage_get("cache_email_"+f+"_aliases",function(e){Script_embed("window.emailtracker_uids="+JSON.stringify([f].concat(Object.values(e))))}),window.emailtracker_listening_sent||(window.emailtracker_listening_sent=1,document.addEventListener("emailtracker_send",function(t){if(!DISCONNECTED){function s(e){window.emailtracker_sending=1,setTimeout(function(){window.emailtracker_sending=0},2500),Script_embed('window["'+t.detail.sid+'"]='+e)}var n=t.detail.object[1]&&t.detail.object[1].indexOf&&0===t.detail.object[1].indexOf("msg")?1:0,e=t.detail.object[n];if(ENABLED&&!~emailtracker_untracked_emails.indexOf("#"+e)){var a,i,d=[];if(DEBUG&&(console.log("Email Tracker Send",t.detail),window.emailtracker_send_detail=t.detail),t.detail.object){var l=t.detail.object,u={id:1,from:[2,2],to:3,cc:4,bcc:5,subject:8,body:[9,2,0,2],message_previous:[9,2,1],message_previous_body:[9,1,1,1],html_enabled:[9,7]};0==n&&(Xtion_foreach(u,function(e,n){u[n]instanceof Array?u[n].forEach(function(e,t){u[n][t]=0<u[n][t]?u[n][t]-1:u[n][t]}):u[n]=0<u[n]?u[n]-1:u[n]}),u.message_previous=[8,1,1],u.message_previous_body=[8,1,1,1]);try{var o=document.createDocumentFragment(),_=document.createElement("div"),m=(o.appendChild(_),_.innerHTML=Xtion_object_indexes(l,u.body),Xtion_object_indexes(l,u.message_previous)&&(a=document.createDocumentFragment(),i=document.createElement("div"),a.appendChild(i),i.innerHTML=Xtion_object_indexes(l,u.message_previous_body),Tracker_remove_previous(a),0==n?l[8][1][1][1]=a.firstChild.innerHTML:l[9][2][1][2]=a.firstChild.innerHTML),d=[].concat(l[u.to]||[],l[u.cc]||[],l[u.bcc]||[]).map(function(e){return 0==n?e[2]?e[2]+" <"+e[1]+">":e[1]:e[3]?e[3]+" <"+e[2]+">":e[2]}).filter(function(e,t,n){return n.indexOf(e)===t}),l[u.subject])}catch(e){Error_report(155,"Extraction Error: "+e,JSON.stringify(l))}function r(e){0!=Xtion_object_indexes(l,u.html_enabled)?Tracker_insert(f,_,document.createElement("button"),function(r,c){Storage_get("cache_email_"+emailtracker_uid+"_aliases",function(e){0==n?l[8][1][0][1]=_.innerHTML:l[9][2][0][2]=_.innerHTML;var i=[],o=(window.LOCATION_TRACKERS_V.forEach(function(t){[emailtracker_uid].concat(e?Object.values(e):[]).forEach(function(e){i.push(t+"?u="+encodeURIComponent(e)+"&amp;e="+encodeURIComponent(r.id))})}),function(t){if(Xtion_instr(Xtion_object_indexes(l,u.body),i)&&(document.removeEventListener("emailtracker_sent",o),!c)){DEBUG&&(console.log("Email Tracker Send Response",t.detail.response),Storage_get("debug_log_send_responses",function(e){(e=e||[]).push(t.detail.response),Storage_update("debug_log_send_responses",e)}));var e,n=0;try{var a=JSON.parse(t.detail.response);try{n=(Object_search(a,"^pfg",1,{limit:9999999,last:1,also:function(e){return e[u.id]&&e[u.id].indexOf&&~e[u.id].indexOf("msg")}})||Object_search(a,"^scheduled",1,{limit:9999999,last:1,also:function(e){return e[u.id]&&e[u.id].indexOf&&~e[u.id].indexOf("msg")}}))[u.id]||0}catch(e){DEBUG&&console.error("ET Response Object Search Error",e);try{if(!(n=a[2][6].reduce(function(e,t){t=Object_property(t,[1,3,7,1]),t=t&&t[5]?t[5].reverse().find(function(e){return e[11].includes("^pfg")||e[11].includes("^scheduled")}):null;return t?t[1]:e},null)))try{n=JSON.parse(t.detail.response)[2][6];try{n=~n[n.length-1][1][3][7][1][5][0][1].indexOf("msg")?n[n.length-1][1][3][7][1][5]:n}catch(e){n=n[n.length-1][1][3][7][1][5]}n=n[n.length-1][1]}catch(e){n=n[n.length-1][1][3][5][3][0]}}catch(e){Error_popup(153,"Extraction Error: "+e,t.detail.response)}}}catch(e){Error_popup(156,"Extraction Parse Error: "+e,t.detail.response)}n&&n.indexOf&&~n.indexOf("msg")?((e=document.querySelector('[data-message-id="#'+n+'"'))&&e.getAttribute("data-emailtracker")&&e.removeAttribute("data-emailtracker"),window.emailtracker_sent_id_last=n,window.emailtracker_sending=0,setTimeout(function(){window.emailtracker_sent_id_last=null},2500),Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(r,{id_source:"1_"+n})}),Tracker_feed_info_insert(r,f,g,"1_"+n,m||"(no subject)","",d),Storage_get("gmail_sent",function(e){(e=e||{})[n]=n,Storage_update("gmail_sent",e)}),Storage_get("cache_tracked_"+f,function(e){(e=e||{})[n]=1,Storage_update("cache_tracked_"+f,e),Storage_get("cache_untracked_"+f,function(e){(e=e||{})[n]&&delete e[n],Storage_update("cache_untracked_"+f,e)})}),document.documentElement.style.cursor="",(a=Object_search(JSON.parse(t.detail.response),"thread-",0,{value_contains:1}))&&a[1]&&(gmail_thread_last_message[a[1]]=n)):(window.emailtracker_sending=0,window[~t.detail.response.indexOf("Your action was unsuccessful")||~t.detail.response.indexOf("Error 502 (Server Error)")||~t.detail.response.indexOf("var gmail_server_error")?"Error_report":"Error_popup"](154,"The email was not sent correctly or if no error shows then Gmail broke the extension please contact us for a fix",t.detail.response))}});document.addEventListener("emailtracker_sent",o);try{s(JSON.stringify(l))}catch(e){Error_popup(152,"Unknown Edge Case: "+e,p.innerHTML)}})},null,{popup_loading_disable:1,uid_alias:e||!1}):(s(-1),Xtion_popup_temporary('Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or click "Untracked" button instead of "Send". Click here to learn how to disable plain text mode.',{container_click:function(){window.open(LOCATION_MAIN+"help/gmail-disable-plain-text-mode")}}))}DEBUG?(e=Xtion_object_indexes(l,u.from))?e!=window.emailtracker_email?Tracker_email_alias_id(window.emailtracker_uid,e,r):r():(Error_report(840,"Alias from email undetected",l),r()):r()}else{var o=document.createDocumentFragment(),p=document.createElement("div");o.appendChild(p),p.innerHTML=t.detail.post.body,t.detail.post.uet&&(a=document.createDocumentFragment(),i=document.createElement("div"),a.appendChild(i),i.innerHTML=t.detail.post.uet,Tracker_remove_previous(a),Script_embed('window["'+t.detail.sid+'_quoted"]='+JSON.stringify(a.firstChild.innerHTML))),d=(d=t.detail.post.to)&&d.filter(function(e){return e}),"0"!==t.detail.post.ishtml?Tracker_insert(f,p,document.createElement("button"),function(n,a){function i(e){var t;Xtion_instr(e.detail.post.body,window.LOCATION_TRACKERS_V.map(function(e){return e+"?u="+encodeURIComponent(f)+"&amp;e="+encodeURIComponent(n.id)}))&&(document.removeEventListener("emailtracker_sent",i),a||(t=0,parse_response(e.detail.response).forEach(function(e){e instanceof Array&&e.forEach(function(e){"a"===e[0]&&e[3]instanceof Array&&e[3][0]&&(t=e[3][0])})}),t?(Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(n,{id_source:"1_"+t})}),Tracker_feed_info_insert(n,f,g,"1_"+t,e.detail.post.subject||"(no subject)","",d),Storage_get("gmail_sent",function(e){(e=e||{})[t]=t,Storage_update("gmail_sent",e)}),Storage_get("cache_tracked_"+f,function(e){(e=e||{})[t]=1,Storage_update("cache_tracked_"+f,e),Storage_get("cache_untracked_"+f,function(e){(e=e||{})[t]&&delete e[t],Storage_update("cache_untracked_"+f,e)})}),document.documentElement.style.cursor=""):window[~e.detail.response.indexOf("Your action was unsuccessful")||~e.detail.response.indexOf("Error 502 (Server Error)")?"Error_report":"Error_popup"](151,"The email was not sent correctly or if no error shows then Gmail broke the extension please contact us for a fix",e.detail.response)))}document.addEventListener("emailtracker_sent",i);try{s(JSON.stringify(p.innerHTML))}catch(e){Error_popup(152,"Unknown Edge Case: "+e,p.innerHTML)}},null,{popup_loading_disable:1}):(s(-1),Xtion_popup_temporary('Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or click "Untracked" button instead of "Send". Click here to learn how to disable plain text mode.',{container_click:function(){window.open(LOCATION_MAIN+"help/gmail-disable-plain-text-mode")}}))}}else s(-1)}})),document.querySelectorAll('[role="dialog"] [aria-label*="Enter"],.aoO[role=button],.Uo').forEach(function(a){var i;a.getAttribute("data-emailtracker")||a.querySelector("img.aPa")||(a.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(a),(i=a.parentNode.parentNode).parentNode.getAttribute("data-emailtracker"))||(i.parentNode.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(i.parentNode),Storage_get("settings",function(e){var t,n;(e=e||{}).button_send_disable_tracking_hide||(t=i.parentNode.querySelector(".emailtracker_untracked"),n=Uniqid("emailtracker_untracked",!0),t&&t.parentNode.removeChild(t),i.insertAdjacentHTML("afterEnd",'<td class="gU emailtracker_untracked" style="width:0;padding:0;margin:0;"></td><td class="gU emailtracker_untracked"><div class="emailtracker_untracked_inner"><div class="'+a.className.replace("aoO","").replace("Uo","")+'" role="button" tabindex="1" data-tooltip="Send without Email Tracker" data-tooltip-delay="800" style="-webkit-user-select: none; position: relative;font-size:10px;" id="'+n+'">Send Untracked</div></div></td>'),setTimeout(function(){document.getElementById(n).onclick=function(){var t=this;Storage_get("warning_untracked",function(e){if(e){window.ENABLED=0;try{window.emailtracker_untracked_emails.push(Xtion_parents(i,"td>form",{contains:1}).querySelector("input[type=hidden][name=draft]").getAttribute("value"))}catch(e){}a.click(),setTimeout(function(){window.ENABLED=1},1e3)}else Storage_update("warning_untracked","1",function(){confirm("Are you sure you want to send this email untracked? This warning will not show up again.")&&t.onclick()})})}},50)),e.button_send_disable_tracking_links&&User_is_pro(function(e){var t;e&&(e=i.parentNode.querySelector(".emailtracker_unlinktracked"),t=Uniqid("emailtracker_unlinktracked",!0),e&&e.parentNode.removeChild(e),i.insertAdjacentHTML("afterEnd",'<td class="gU emailtracker_unlinktracked" style="padding-right:1px;"><div class="emailtracker_untracked_inner"><div class="'+a.className.replace("aoO","").replace("Uo","")+'" role="button" tabindex="1" data-tooltip="Send without Link Tracking" data-tooltip-delay="800" style="-webkit-user-select:none;position:relative;margin-right:0;font-size:10px;" id="'+t+'">Unlink Tracked</div></div></td>'),setTimeout(function(){document.getElementById(t).onclick=function(){var t=this;Storage_get("warning_unlinktracked",function(e){e?Storage_get("tracking_links_disabled",function(e){e?a.click():Storage_update("tracking_links_disabled",1,function(){a.click(),setTimeout(function(){Storage_update("tracking_links_disabled",0)},1e3)})}):Storage_update("warning_unlinktracked","1",function(){confirm("Are you sure you want to send this email without link tracking? This warning will not show up again.")&&t.onclick()})})}},50))},!0)}))}),e&&document.querySelector("[data-message-id]")&&!window.emailtracker_sending&&(c=[],document.querySelectorAll("[data-message-id]").forEach(function(e){e.getAttribute("data-emailtracker")||(e.setAttribute("data-emailtracker","1"),void 0!==window.emailtracker_messages_tracking[e.getAttribute("data-message-id").replace("#","")]&&0===window.emailtracker_messages_tracking[e.getAttribute("data-message-id").replace("#","")])||c.push({id:"1_"+e.getAttribute("data-message-id").replace("#",""),id_legacy:e.getAttribute("data-legacy-message-id")?"1_"+e.getAttribute("data-legacy-message-id"):null})}),c.length)&&Storage_get("cache_opened_"+f,function(r){r=r||{},Storage_get("cache_untracked_"+f,function(t){t=t||{};function n(e){DISCONNECTED||e.forEach(function(a){try{try{Array.prototype.slice.call(document.querySelector('[data-message-id="#'+a.id_source.replace("1_","")+'"],[data-legacy-message-id="'+a.id_source.replace("1_","")+'"]').querySelectorAll("[role=checkbox]")).forEach(function(e){if(!e.getAttribute("data-emailtracker")&&(e.setAttribute("data-emailtracker","1"),!(e=e.parentNode).getElementsByClassName("emailtracker_status").length)){e.insertAdjacentHTML("afterBegin",Tracker_icon(a,{style:"position:relative;top:-"+(s?"2":"6")+"px;padding:0 6px;"})),0;var t,n=0;try{Xtion_parents(e,'[role="listitem"]').querySelectorAll("span[email]").forEach(function(e){if(e.getAttribute("email").toLowerCase()!==g.toLowerCase())throw n=0,{};n++})}catch(e){}2!=n&&3!=n||(e=Xtion_parents(e,"[role=listitem]").querySelector(window.LOCATION_TRACKERS_V.map(function(e){return'img[src*="'+e+"?u="+f+'"]'}).join(",")))&&(t=e.src.split("#"),e.src=(t[1]||t[0]).replace("?u=","?self&u=")),1==a.status&&(r[a.id_source]=1)}})}catch(e){console.error(e)}}catch(a){}})}var a=[],i=[],o=[];c.forEach(function(e){window.emailtracker_sent_id_last&&window.emailtracker_sent_id_last===e.id.replace("1_","")?(window.emailtracker_sent_id_last=null,o.push({id_source:e.id,status:0})):r[e.id]||r[e.id_legacy]?a.push({id_source:r[e.id]?e.id:e.id_legacy,status:1}):t[e.id]||t[e.id_legacy]||(i.push(e.id),e.id_legacy&&i.push(e.id_legacy))});i.length?Request_background(LOCATION_ACTION+"user_emails?client=gmail_messages",function(e){n(JSON.parse(e).concat(a).concat(o)),Storage_update("cache_opened_"+f,r)},{post:{id_user:f,emails:i}}):n(a.concat(o))})}),!window.InboxSDK&&!document.querySelector("[data-thread-id]")||document.querySelector('[data-thread-id*="msg"]')&&0!==location.hash.indexOf("#sent")&&0!==location.hash.indexOf("#search")&&0!==location.hash.indexOf("#advanced-search")||(d=[],n=[],document.querySelectorAll("[data-inboxsdk-threadid],[data-thread-id]").forEach(function(e){var t=(e.getAttribute("data-inboxsdk-threadid")||e.getAttribute("data-thread-id")).replace("#","");e.getAttribute("data-emailtracker")||(e&&gmail_thread_last_message[t]&&(e.setAttribute("data-emailtracker","1"),e.setAttribute("data-emailtracker-message",gmail_thread_last_message[t]),n.push(e),d.push(t)),e&&(gmail_thread_last_message_legacy[t]||gmail_thread_last_message_legacy[e.getAttribute("data-legacy-last-non-draft-message-id")||e.getAttribute("data-legacy-last-message-id")])&&(e.setAttribute("data-emailtracker","1"),e.setAttribute("data-emailtracker-message-legacy",gmail_thread_last_message_legacy[t]||gmail_thread_last_message_legacy[e.getAttribute("data-legacy-last-non-draft-message-id")||e.getAttribute("data-legacy-last-message-id")])))}),n.length&&Storage_get("cache_opened_"+f,function(c){c=c||{},Storage_get("cache_untracked_"+f,function(r){r=r||{},Storage_get("gmail_sent",function(n){n=n||{};function t(e){var a=[];e.forEach(function(t){document.querySelectorAll('[data-emailtracker-message="'+t.id_source.replace("1_","")+'"],[data-emailtracker-message-legacy="'+t.id_source.replace("1_","")+'"]').forEach(function(e){e.getAttribute("data-thread-id")&&(e=Xtion_parents(e,"tr")),a.push(t.id_source),e&&!e.classList.contains("emailtracker")&&(e.classList.add("emailtracker"),s?e.innerHTML+='<td class="xY" style="padding-right:8px;order:1"> '+Tracker_icon(t,{style:"position:relative;"})+"</td>":(e=e.children)[e.length-2].innerHTML+=" "+Tracker_icon(t,{style:"position:relative;top:-2px;margin-left:2px;"}),1==t.status)&&(c[t.id_source]=1)})}),Storage_get("cache_tracked_"+f,function(n){n=n||{},i.forEach(function(e,t){~a.indexOf(e)||n[e]||(r[e]=1)})})}var i=[],a=[],o=[];d.forEach(function(e){var t="1_"+(n[e]||gmail_thread_last_message[e]),t=(i.push(t),c[t]?a.push({id_source:t,status:1}):r[t]||o.push(t),gmail_thread_last_message_legacy[e]);t&&(i.push(t="1_"+t),c[t]?a.push({id_source:t,status:1}):r[t]||o.push(t))});o.length?Request_background(LOCATION_ACTION+"user_emails?client=gmail_threads",function(e){t(JSON.parse(e).concat(a)),Storage_update("cache_opened_"+f,c),Storage_update("cache_untracked_"+f,r)},{post:{id_user:f,emails:o}}):t(a)})})}))})})},{interval:500}),window.gmail_thread_last_message||(window.gmail_thread_last_message=localStorage.emailtracker_cache_threads_last_message?JSON.parse(localStorage.emailtracker_cache_threads_last_message):{}),window.gmail_thread_last_message_legacy||(window.gmail_thread_last_message_legacy=localStorage.emailtracker_cache_threads_last_message_legacy?JSON.parse(localStorage.emailtracker_cache_threads_last_message_legacy):{}),window.gmail_messages=[],window.addEventListener("beforeunload",function(){localStorage.emailtracker_cache_threads_last_message="",localStorage.emailtracker_cache_threads_last_message_legacy=""}),document.addEventListener("emailtracker_threads",function(e){var n,t,a;window.DISCONNECTED||(DEBUG&&console.log("emailtracker_threads",e.detail),n=[],"xhr_threads"===e.detail.type?(t=JSON.parse(e.detail.data),(a=Xtion_object_indexes(t,3,0,1,4))&&a.indexOf&&0===a.indexOf("thread")?t[3].forEach(function(e){n.push(e[1])}):(a=Xtion_object_indexes(t,2,0,0,3))&&a.indexOf&&0===a.indexOf("thread")&&t[2].forEach(function(e){n.push(e[0])})):"xhr_threads_new"===e.detail.type?(t=JSON.parse(e.detail.data),(a=Xtion_object_indexes(t,2,6,0,1,3,7,1,4))&&a.indexOf&&0===a.indexOf("thread")&&t[2][6].forEach(function(e){var t=Xtion_object_indexes(e,1,3,7,1);t&&e&&e[1]&&e[1][1]&&e[1][1].indexOf&&0===e[1][1].indexOf("thread")&&n.push(t)})):"embedded_a6jdv"===e.detail.type?e.detail.data.forEach(function(e){e&&e[2]&&(e=Xtion_object_indexes(JSON.parse(e[2]),1,1))&&e.forEach(function(e){n.push(e[5])})}):"embedded_Cl6csf"===e.detail.type&&e.detail.data.forEach(function(e){e&&e[2]&&(e=Xtion_object_indexes(JSON.parse(e[2]),2))&&e.forEach(function(e){n.push(e[2])})}),n.length&&(DEBUG&&console.debug("emailtracker_threads_found",n),Storage_get("gmail_sent",function(i){i=i||{},n.forEach(function(e){var t={thread_id:4,thread_messages:5,message_id:1,thread_messages_labels:11,legacy_message_id:48,legacy_message_id2:56},n=(e[3]&&e.indexOf&&0===e[3].indexOf("thread")&&(t={thread_id:3,thread_messages:4,message_id:0,thread_messages_labels:10,legacy_message_id:47,legacy_message_id2:55}),e[t.thread_id]),a=!1;e&&e[t.thread_messages]instanceof Array&&e[t.thread_messages].reverse().forEach(function(e){!a&&e&&e[t.thread_messages_labels]instanceof Array&&~e[t.thread_messages_labels].indexOf("^f")&&(a=e)}),a[t.legacy_message_id]?gmail_thread_last_message_legacy[n]=decToHex(a[t.legacy_message_id]):a[t.legacy_message_id2]&&(gmail_thread_last_message_legacy[n]=a[t.legacy_message_id2]),gmail_thread_last_message[n]=i[n]||a[t.message_id]}),localStorage.emailtracker_cache_threads_last_message_legacy=JSON.stringify(gmail_thread_last_message_legacy),localStorage.emailtracker_cache_threads_last_message=JSON.stringify(gmail_thread_last_message)})))}),document.addEventListener("emailtracker_info",function(a){window.DISCONNECTED||(window.DEBUG&&console.log("emailtracker_info",a),window.DEBUG&&a.detail.aliases&&Interval_retry(function(){return window.emailtracker_uid},function(){var e,t,n=[];a.detail.aliases.forEach(function(e){e=e[1];Email_valid(e)&&n.push(e)}),n.length&&(e=0,(t=function(){Tracker_email_alias_id(window.emailtracker_uid,n[e],function(){n[++e]&&t()})})())}))}),document.addEventListener("emailtracker_threads_old",function(e){var n;window.DISCONNECTED||(n=[],parse_response(e.detail.data).forEach(function(e){e&&e[0]&&"tb"===e[0][0]?e[0][2].forEach(function(e){n.push(e)}):e instanceof Array&&e.forEach(function(e){e instanceof Array&&"tb"===e[0]?e[2].forEach(function(e){n.push(e)}):e instanceof Array&&e.forEach(function(e){e instanceof Array&&"cs"===e[0]&&n.push([e[1],e[2]])})})}),n.length&&Storage_get("gmail_sent",function(t){t=t||{},n.forEach(function(e){gmail_thread_last_message[e[0]]=t[e[0]]||e[1]}),localStorage.emailtracker_cache_threads_last_message=JSON.stringify(gmail_thread_last_message)}))}),window.emailtracker_messages_tracking=[],document.addEventListener("emailtracker_messages",function(t){window.DISCONNECTED||Storage_get("cache_email_"+emailtracker_uid+"_aliases",function(i){var e=JSON.parse(t.detail.data);e&&e[2]instanceof Array&&0===e[2][0][1].indexOf("thread")&&e[2].forEach(function(e){e[3]instanceof Array&&e[3].forEach(function(t){var n,a;0===t[1].indexOf("msg")&&t[2]&&t[2][6]&&t[2][6][2]&&(n=Xtion_object_indexes(t,2,6,2,3,3,2),a=0,[window.emailtracker_uid].concat(i?Object.values(i):[]).forEach(function(e){a||(a=~t[2][6][2][0][3][2].indexOf(e="https://my-email-signature.link/signature.gif?u="+e+"&")||(n&&~n.indexOf(e)?1:0))}),window.emailtracker_messages_tracking[t[1]]=a)})})})}),setTimeout(function(){Variable("GM_SPT_ENABLED",function(e){"false"===e&&window.InboxSDK&&InboxSDK.load("1.0","sdk_production_90a8834de7").then(function(e){(window.emailtracker_inboxsdk=e).Lists.registerThreadRowViewHandler(function(e){clearTimeout(window.gmail_threads_loading_timeout),window.gmail_threads_loading=1,window.gmail_threads_loading_timeout=setTimeout(function(){window.gmail_threads_loading=0},500)})})})},1e3),document.documentElement.classList.add("emailtracker_gmail")):~window.location.host.indexOf("inbox.google.com")?(google_inbox_url=function(){return location.protocol+"//"+location.hostname+(0===location.pathname.indexOf("/u/")?"/u/"+location.pathname.split("/")[2]+"/":"/")},Tracker(function(t){Variable("(window.gbar?window.gbar._CONFIG[0][10]:null)",function(e){e&&t(e[5])})},function(uid,email){var f=function(el){Tracker_insert(uid,el.parentNode.parentNode.parentNode.parentNode.querySelector('[role=textbox],.editable[jsaction*=compose],[g_editable="true"]'),el,function(tracking,cancel){try{el.parentNode.parentNode.querySelector("button[jsaction*=close]").addEventListener("click",function(){cancel=1},!0)}catch(e){}el.parentNode.parentNode.addEventListener("keydown",function(e){27===e.keyCode&&(cancel=1)},!0);var subject=el.parentNode.parentNode.parentNode.querySelector(".iO>input"),subject=subject?subject.value:document.querySelector(".eo").textContent,to=[],sending=(el.parentNode.parentNode.parentNode.querySelectorAll("div[email]").forEach(function(e){var t=e.getAttribute("aria-label"),e=e.getAttribute("email");to.push(t+(t!==e?" <"+e+">":""))}),setInterval(function(){var retries,retries_max,f;null===el.offsetParent&&(clearInterval(sending),cancel||(retries=0,retries_max=5,f=function(){setTimeout(function(){Xtion_request(google_inbox_url()+"sent",function(r){try{eval("window.embeddedAppData="+Xtion_string_between(r,"preloadedData=",";window.BT"));for(var data=window.embeddedAppData,i=0;i<data.length;i++){var m=data[i];if(m&&m.indexOf&&~m.indexOf("items")){try{var messages=JSON.parse(m)}catch(err){if(retries<retries_max)return retries++,void setTimeout(f,1e3);Error_popup(204,err,r)}if(messages.tables&&messages.tables.items&&!messages.tables.items.length){if(retries<retries_max)return retries++,void setTimeout(f,1e3);Error_popup(203,"Inbox Configuration not yet supported please contact us for compatibility")}var messages=messages.tables?messages.tables.items:messages[1][1],last=0,em="",id="";if(messages.forEach(function(e){var e=e.c||e.d||e,t=e[1]&&e[1][4]?e[1][4]:e[5][3],n=1===e[2].length?e[1][1]:e[2].pop?e[2].pop()[1]:e[2];e&&last<t&&(last=t,em=e,id=n.split(":").pop())}),id){Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(tracking,{id_source:"4_"+id})}),Tracker_feed_info_insert(tracking,uid,email,"4_"+id,subject||"(no subject)","",to),document.documentElement.style.cursor="";break}Error_popup(200,"Inbox Changed Their Structure. Please contact us for a fix.",r)}}}catch(e){Error_popup(201,e,r)}})},500)},f()))},100))},null,{remove_previous_blank_src:1})},ids=(document.querySelectorAll('[jsaction*="send"]').forEach(function(t){t.getAttribute("data-emailtracker")||"global.cancel_send"===t.getAttribute("jsaction")||(t.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(t),t.style.position="relative",t.innerHTML+='<div style="position:absolute;top:-1px;left:-1px;width:105%;height:105%;"></div>',t.lastChild.addEventListener("click",function(e){Tracker_send(function(){e.stopPropagation(),e.preventDefault(),f(t)},t)},!0),t.parentNode.parentNode.addEventListener("keydown",function(e){Tracker_send(function(){(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),f(t))})},!0))}),[]),t;document.querySelectorAll("[data-item-id],[data-msg-id]").forEach(function(e){e.firstChild.classList.contains("emailtracker")||(e.firstChild.classList.add("emailtracker"),e=(e.getAttribute("data-item-id")||e.getAttribute("data-msg-id")).split(":").pop(),ids.push(0===e.indexOf("r")?"4_"+e:"1_"+decToHex(e)))}),ids.length&&Request_background(LOCATION_ACTION+"emails?client=inbox",function(e){JSON.parse(e).forEach(function(t){var e=t.id_source.split("_").pop(),n=(0===t.id_source.indexOf("1_")&&(e=hexToDec(e)),document.querySelector('[data-item-id*="'+e+'"],[data-msg-id*="'+e+'"]'));n.style.willChange="no",setInterval(function(){if(!n.querySelector(".emailtracker_status"))try{var e;!n.classList.contains("scroll-list-item")||n.classList.contains("scroll-list-item-open")?(e=(e=n.querySelectorAll(n.querySelector("[data-msg-id]")?"[data-msg-id]:first-child .action":".action"))[e.length-1].parentNode.firstChild).insertAdjacentHTML("afterBegin",Tracker_icon(t)+" "):((e=n.querySelector("[email]").parentNode.parentNode).style.position="relative",e.innerHTML+=Tracker_icon(t,{style:"position:absolute;right:0;"}))}catch(e){}},1e3)})},{post:{emails:ids}}),window.thread_load||(window.thread_load=1,t=Xtion_uri_query_parameters(location.search),t&&t.th&&setTimeout(function(){document.querySelector('[data-item-id*="'+t.th+'"] [jsaction]').click()},1e3))})):~window.location.host.indexOf("outlook.live.com")||~window.location.host.indexOf("outlook.office365.com")||~window.location.host.indexOf("outlook.office.com")||0===location.pathname.indexOf("/owa/")?0===location.pathname.indexOf("/owa/")?(Script_inject(chrome.extension.getURL("lib/outlook.js")),Tracker(function(t){Variable("owaSDState.data",function(e){e&&t(Xtion_string_between(e,'LogonEmailAddress":"','",'))})},function(d,l){var u;window.emailtracker_listening_sent||(window.emailtracker_listening_sent=1,u=(new Date).getTime()-15e3,document.addEventListener("emailtracker_send",function(t){var e,n,c,s,a,i,o;DISCONNECTED||(e=function(e){Script_embed('window["'+t.detail.sid+'"]='+e)},ENABLED?(i=t.detail.post.Body,(n=i.Items?i.Items[0].Body:i.ItemChanges[0].Updates)instanceof Array&&n.forEach(function(e){e.Item&&e.Item.Body&&(n=e.Item.Body)}),(c=i.Items?i.Items[0].Subject:i.ItemChanges[0].Updates)instanceof Array&&c.forEach(function(e){e.Item&&void 0!==e.Item.Subject&&(c=e.Item.Subject)}),s=[],(a=i.Items?i.Items[0].ToRecipients:i.ItemChanges[0].Updates)instanceof Array&&a.forEach(function(e){e.Item&&e.Item.ToRecipients&&(a=e.Item.ToRecipients)}),a.forEach(function(e){s.push(e.Name+(e.Name!==e.EmailAddress?" <"+e.EmailAddress+">":""))}),i=document.createDocumentFragment(),o=document.createElement("div"),i.appendChild(o),o.innerHTML=n.Value,"HTML"===n.BodyType?Tracker_insert(d,o,document.createElement("button"),function(r,n){function a(e){var t;e.detail.post&&e.detail.post.Body&&(e=e.detail.post.Body,(t=e.Items?e.Items[0].Body:e.ItemChanges[0].Updates)instanceof Array&&t.forEach(function(e){e.Item&&e.Item.Body&&(t=e.Item.Body)}),Xtion_instr(t.Value,window.LOCATION_TRACKERS_V.map(function(e){return e+"?u="+encodeURIComponent(d)+"&amp;e="+encodeURIComponent(r.id)})))&&(document.removeEventListener("emailtracker_sent",a),n||setTimeout(function(){Background_cookie("X-OWA-CANARY",function(e){var a=0,i=15,o=function(){Xtion_request("https://"+window.location.host+"/owa/service.svc",function(t){var e,n;try{(n=JSON.parse(t).Body.ResponseMessages.Items[0].RootFolder.Items[0]||null)&&new Date(n.DateTimeSent).getTime()>=u&&c==n.Subject?(e=n.ItemId.Id,Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(r,{id_source:"2_"+e})}),Tracker_feed_info_insert(r,d,l,"2_"+e,c||"(no subject)","https://"+window.location.host+"/owa/?viewmodel=ReadMessageItem&ispopout=1&ItemID="+encodeURIComponent(e),s)):a<i?(a++,setTimeout(o,1e3)):Error_popup(322,"Outlook1 tracking computer time incorrect incompatibility. Please contact us for a fix",JSON.stringify([t].concat(n?[new Date(n.DateTimeSent).getTime(),u,c,n.Subject]:[])))}catch(e){Error_popup(320,"Outlook1 changes broke Email Tracker. Please contact us for a fix: "+e,t)}},{post:{},headers:{Action:"FindItem","X-OWA-CANARY":e,"X-OWA-UrlPostData":encodeURIComponent('{"__type":"FindItemJsonRequest:#Exchange","Header":{"__type":"JsonRequestHeaders:#Exchange","RequestServerVersion":"Exchange2013","TimeZoneContext":{"__type":"TimeZoneContext:#Exchange","TimeZoneDefinition":{"__type":"TimeZoneDefinitionType:#Exchange","Id":"Pacific Standard Time"}}},"Body":{"__type":"FindItemRequest:#Exchange","ItemShape":{"__type":"ItemResponseShape:#Exchange","BaseShape":"IdOnly"},"ParentFolderIds":[{"__type":"DistinguishedFolderId:#Exchange","Id":"sentitems"}],"Traversal":"Shallow","Paging":{"__type":"IndexedPageView:#Exchange","BasePoint":"Beginning","Offset":0,"MaxEntriesReturned":5},"ViewFilter":"All","IsWarmUpSearch":false,"ShapeName":"MailListItem","SortOrder":[{"__type":"SortResults:#Exchange","Order":"Descending","Path":{"__type":"PropertyUri:#Exchange","FieldURI":"DateTimeSent"}}]}}')}})};o()},{url:"https://"+window.location.host})},1e3))}document.addEventListener("emailtracker_sent",a),e(JSON.stringify(o.innerHTML))},null,{popup_loading_disable:0}):(e(-1),Xtion_popup_temporary('Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or click "Untracked" button instead of "Send"'))):e(-1))})),window.error_report_custom.language||Background_cookie("mkt",function(e){window.error_report_custom.language=e},{url:"https://"+window.location.host}),~window.location.href.indexOf("mail/sentitems")&&window.cache_sent_indexes&&setTimeout(function(){document.querySelectorAll("[role=listbox] [role=option]");for(var e in window.cache_sent_indexes)Icon_insert(e,window.cache_sent_indexes[e],Uniqid("",!0).replace(".","_"))},300)}),window.emailtracker_id_loading=[],window.Icon_insert=function(e,t,n){function a(e){document.querySelector('[data-emailtracker-id="'+t.id_source+'"]')||(e.insertAdjacentHTML("afterBegin",Tracker_icon(t,{attributes:'data-emailtracker-id="'+t.id_source+'" data-emailtracker-'+n+'="'+t.id_source+'"'})+" "),~window.cache_id_detection.indexOf(n))||(window.cache_id_detection.forEach(function(e){~window.location.href.indexOf("mail/sentitems")&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_detection.push(n))}var i,o=Array.prototype.slice.call(document.querySelectorAll("[role=listbox] [role=option]")).filter(function(e){return e.offsetParent});window.cache_sent_indexes_conversation?document.querySelector(".allowTextSelection[role=document]>.conductorContent")?(i=o[e])&&a((i=i.lastElementChild.previousElementSibling.previousElementSibling.getElementsByTagName("span"))[i.length-1]):(i=o[e])&&a((i=i.querySelector("span[class*=Subject],span[role=note]").parentNode.parentNode.previousElementSibling.getElementsByTagName("span"))[i.length-1]):(i=document.querySelectorAll(".searchFolder")[e])?a(i.nextElementSibling):(i=o[e])&&a((i=i.lastElementChild.previousElementSibling.previousElementSibling.getElementsByTagName("span"))[i.length-1])},document.addEventListener("emailtracker_items",function(t){var n,a,i,o,r;~window.location.href.indexOf("mail/sentitems")&&(window.cache_sent_indexes={},(t=(n=(t=JSON.parse(t.detail.body).Body).Conversations)?{IndexedPagingOffset:t.IndexedOffset,Items:t.Conversations}:t.ResponseMessages.Items[0].RootFolder).Items)&&t.Items.length&&(a=t.IndexedPagingOffset-t.Items.length,i=Uniqid("",!0).replace(".","_"),window.cache_sent_indexes_conversation=n,o=[],r=[],t.Items.forEach(function(e){o.push(n?"2_"+e.ItemIds[e.ItemIds.length-1].Id:"2_"+e.ItemId.Id),r.push("2_"+e.ConversationId.Id)}),o.length)&&!~window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset)&&Request_background(LOCATION_ACTION+"emails?client=outlook_live",function(e){window.emailtracker_id_loading.push(t.IndexedPagingOffset),setTimeout(function(){JSON.parse(e).forEach(function(e){var t=a+(~o.indexOf(e.id_source)?o:r).indexOf(e.id_source);window.cache_sent_indexes[t]=e,Icon_insert(t,e,i)}),window.emailtracker_id_loading.splice(window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset),1)},800)},{post:{emails:o.concat(r)}})}),window.cache_id_detection=[],window.cache_id_deletion=[],setInterval(function(){DISCONNECTED||(window.cache_id_detection.forEach(function(e){~window.location.href.indexOf("mail/sentitems")&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_deletion.forEach(function(e){document.querySelectorAll("[data-emailtracker-"+e+"]").forEach(function(e){e.parentNode.removeChild(e)})}))},200)):0===location.pathname.indexOf("/mail/")&&(Script_inject(chrome.extension.getURL("lib/outlook2.js")),inbox_index=Xtion_string_between(location.pathname,"/mail/","/"),isNaN(inbox_index)&&!~inbox_index.indexOf("@")&&(inbox_index=""),~location.search.indexOf("emailtracker_id")&&(0===location.pathname.indexOf("/mail/"+inbox_index+"/deeplink")?setTimeout(function(){document.querySelector('[role="main"]')||(location.href="https://"+window.location.host+"/mail/"+inbox_index+"/sentitems?emailtracker_id="+encodeURIComponent(new URLSearchParams(window.location.search).get("emailtracker_id")))},5e3):0===location.pathname.indexOf("/mail/"+inbox_index+"/sentitems")&&Interval_retry(function(){return document.querySelector("#searchBoxId-Mail input,#owaSearchBox_container input")},function(e){e.focus(),setTimeout(function(){React_input_set_value(e,"&e="+new URLSearchParams(window.location.search).get("emailtracker_id")+"&v="),setTimeout(function(){document.querySelector('#searchBoxId-Mail + button,[role="search"]>button').click()},500)},500)})),Xtion_request("https://"+window.location.host+"/owa/"+inbox_index+"/sessiondata.ashx?app=Mail",function(e){var t=JSON.parse(e).owaUserConfig.SessionSettings.UserEmailAddress;t||Error_report(470),window.window.emailtracker_ini=0,window.emailtracker_listening_sent=0,Tracker(function(e){e(t)},function(e,t){window.emailtracker_uid=e,window.emailtracker_email=t,window.emailtracker_listening_sent||(window.emailtracker_listening_sent=1,document.addEventListener("emailtracker_send",function(t){var a,e,s,n,d,l,i,o,r;DISCONNECTED||(a="emailtracker_sent"+t.detail.sid,e=function(e){Script_embed('window["'+t.detail.sid+'"]='+e)},ENABLED?(o=t.detail.post.Body,s=moment().unix()-60,(n=o.Items?o.Items[0].NewBodyContent||o.Items[0].Body:o.ItemChanges[0].Updates)instanceof Array&&n.forEach(function(e){e.Item&&e.Item.Body&&(n=e.Item.Body)}),(d=o.Items?o.Items[0].Subject:o.ItemChanges[0].Updates)instanceof Array&&d.forEach(function(e){e.Item&&void 0!==e.Item.Subject&&(d=e.Item.Subject)}),l=[],(i=o.Items?o.Items[0].ToRecipients:o.ItemChanges[0].Updates)instanceof Array&&i.forEach(function(e){e.Item&&e.Item.ToRecipients&&(i=e.Item.ToRecipients)}),i.forEach(function(e){l.push(e.Name+(e.Name!==e.EmailAddress?" <"+e.EmailAddress+">":""))}),o=document.createDocumentFragment(),r=document.createElement("div"),o.appendChild(r),r.innerHTML=n.Value,"HTML"===n.BodyType?Tracker_insert(window.emailtracker_uid,r,document.createElement("button"),function(c,t){function n(e){document.removeEventListener(a,n),t||setTimeout(function(){e&&e.detail&&e.detail.headers&&e.detail.headers.has("date")&&(s=moment(e.detail.headers.get("date")).unix()-60);var i=0,o=15,r=function(){Xtion_request("https://"+window.location.host+"/owa/"+inbox_index+"/service.svc?action=FindItem&EP=1&app=Mail",function(t){var n=null;try{var e,n=null,a=JSON.parse(t).Body.ResponseMessages.Items;a[0]&&a.forEach(function(e){e.RootFolder.Items[0]&&e.RootFolder.Items.forEach(function(t){t.ExtendedProperty&&t.ExtendedProperty[0]&&(t.IsDraft?t.ExtendedProperty.forEach(function(e){!e.ExtendedFieldURI||"0x3FEF"!==e.ExtendedFieldURI.PropertyTag&&"0x3fef"!==e.ExtendedFieldURI.PropertyTag||"SystemTime"!==e.ExtendedFieldURI.PropertyType||t.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_id"===e.ExtendedFieldURI.PropertyName&&e.Value.split("_")[0]===c.id&&(n=t)})}):t.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_id"===e.ExtendedFieldURI.PropertyName&&e.Value.split("_")[0]===c.id&&(n=t)}))})}),n?(e=n.ItemId.Id,Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(c,{id_source:"2_"+e})}),Tracker_feed_info_insert(c,window.emailtracker_uid,window.emailtracker_email,"2_"+e,d||"(no subject)","https://"+window.location.host+"/mail/"+inbox_index+"deeplink/read/"+encodeURIComponent(e)+"?emailtracker_eid="+c.id,l)):i<o?(i++,setTimeout(r,2e3)):Error_popup(n?323:324,n?"Outlook2 mismatch subject error":"Outlook2 fetch error",JSON.stringify([t].concat(n?[moment(n.DateTimeSent).unix(),s,d,n.Subject]:[c,s])))}catch(e){Error_popup(321,"Outlook2 changes broke Email Tracker. Please contact us for a fix: "+e,t)}},{post:{},headers:{Action:"FindItem","X-OWA-CANARY":Cookie_get("X-OWA-CANARY"),"X-OWA-UrlPostData":encodeURIComponent(JSON.stringify({__type:"FindItemJsonRequest:#Exchange",Header:{__type:"JsonRequestHeaders:#Exchange",RequestServerVersion:"V2018_01_08",TimeZoneContext:{__type:"TimeZoneContext:#Exchange",TimeZoneDefinition:{__type:"TimeZoneDefinitionType:#Exchange",Id:"Pacific Standard Time"}}},Body:{__type:"FindItemRequest:#Exchange",ParentFolderIds:[{__type:"DistinguishedFolderId:#Exchange",Id:"sentitems"},{__type:"DistinguishedFolderId:#Exchange",Id:"drafts"}],ItemShape:{__type:"ItemResponseShape:#Exchange",BaseShape:"IdOnly",AdditionalProperties:[{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"0f593b63-959d-4095-910c-c7dfe59ce739",PropertyName:"emailtracker_id",PropertyType:"String"},{__type:"ExtendedPropertyUri:#Exchange",PropertyTag:"0x3FEF",PropertyType:"SystemTime"}]},ShapeName:"MailListItem",Traversal:"Shallow",Paging:{__type:"IndexedPageView:#Exchange",BasePoint:"Beginning",Offset:0,MaxEntriesReturned:5},FocusedViewFilter:-1,ViewFilter:"All",SortOrder:[{__type:"SortResults:#Exchange",Order:"Descending",Path:{__type:"PropertyUri:#Exchange",FieldURI:"DateTimeReceived"}}]}}))}})};r()},1e3)}document.addEventListener(a,n),e(JSON.stringify({body:r.innerHTML,id_tracking:c.id,id_tracking_v:c.idv}))},null,{popup_loading_disable:0}):(e(-1),Xtion_popup_temporary("Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or temporarily disable Email Tracker"))):e(-1))})),~window.location.href.indexOf("/sentitems")&&window.cache_sent_indexes&&setTimeout(function(){document.querySelectorAll("[role=listbox] [role=option]");for(var e in window.cache_sent_indexes)Icon_insert(e,window.cache_sent_indexes[e],Uniqid("",!0).replace(".","_"))},300)})},{method:"post"}),window.emailtracker_id_loading=[],window.Icon_insert=function(e,t,n){function a(e){document.querySelector('[data-emailtracker-id="'+t.id_source+'"]')||(e.insertAdjacentHTML("afterBegin",Tracker_icon(t,{attributes:'data-emailtracker-id="'+t.id_source+'" data-emailtracker-'+n+'="'+t.id_source+'"'})+" "),~window.cache_id_detection.indexOf(n))||(window.cache_id_detection.forEach(function(e){~window.location.href.indexOf("sentitems")&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_detection.push(n))}var i,o=Array.prototype.slice.call(document.querySelectorAll("[role=listbox] [role=option],[role=complementary] [role=option]")).filter(function(e){return e.offsetParent});window.cache_sent_indexes_conversation?document.querySelector(".allowTextSelection[role=document]>.conductorContent")?(i=o[e])&&a((i=i.lastElementChild.previousElementSibling.previousElementSibling.getElementsByTagName("span"))[i.length-1]):(i=o[e])&&a(i=i.querySelector('span[title*=":"],span[title*="-"],span[title*="/"]')):(i=document.querySelectorAll(".searchFolder")[e])?a(i.nextElementSibling):(i=o[e])&&a(i=i.querySelector('span[title*=":"],span[title*="-"],span[title*="/"]'))},document.addEventListener("emailtracker_items",function(t){var n,a,i,o,r,c,s,d,l;!DISCONNECTED&&~window.location.href.indexOf("/sentitems")&&(window.cache_sent_indexes={},(t=(n=(t=JSON.parse(t.detail.body).Body).Conversations)?{IndexedPagingOffset:t.IndexedOffset,Items:t.Conversations}:t.ResponseMessages.Items[0].RootFolder).Items)&&t.Items.length&&(a=t.IndexedPagingOffset-t.Items.length,i=Uniqid("",!0).replace(".","_"),window.cache_sent_indexes_conversation=n,o=[],r=[],c=[],s=[],t.Items.forEach(function(e){var t;n?o.push("2_"+e.ItemIds[0].Id):(o.push("2_"+e.ItemId.Id),t="",e.ExtendedProperty&&e.ExtendedProperty instanceof Array&&e.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_idv"===e.ExtendedFieldURI.PropertyName&&~e.Value.indexOf("_")&&(t=e.Value.split("_")[0],s.push(e.Value))}),c.push(t)),r.push("2_"+e.ConversationId.Id)}),o.length)&&!~window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset)&&(d=function(){Request_background(LOCATION_ACTION+"emails2?client=outlook_live",function(e){window.emailtracker_id_loading.push(t.IndexedPagingOffset),setTimeout(function(){JSON.parse(e).forEach(function(e){var t=a+(e.id&&~c.indexOf(e.id)?c.indexOf(e.id):(~o.indexOf(e.id_source)?o:r).indexOf(e.id_source));window.cache_sent_indexes[t]=e,Icon_insert(t,e,i)}),window.emailtracker_id_loading.splice(window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset),1)},800)},{post:{emails:o.concat(r),email_ids:s}})},n&&(l=[],o.forEach(function(e){void 0===window.cache_conversation_item_emailtracker_ids[e]?(c.push(""),l.push({__type:"ItemId:#Exchange",Id:e.replace("2_","")})):window.cache_conversation_item_emailtracker_ids[e]?(c.push(window.cache_conversation_item_emailtracker_ids[e].split("_")[0]),s.push(window.cache_conversation_item_emailtracker_ids[e])):c.push("")}),l.length)?Xtion_request("https://"+window.location.host+"/owa/"+inbox_index+"/service.svc?action=GetItem&app=Mail",function(t){try{var e=JSON.parse(t).Body.ResponseMessages.Items;e[0]&&(e.forEach(function(t){var n;t&&t.Items&&t.Items[0]&&(t=t.Items[0],n="",t.ExtendedProperty&&t.ExtendedProperty instanceof Array&&t.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_idv"===e.ExtendedFieldURI.PropertyName&&~e.Value.indexOf("_")&&(c[o.indexOf("2_"+t.ItemId.Id)]=e.Value.split("_")[0],n=e.Value,s.push(e.Value))}),window.cache_conversation_item_emailtracker_ids["2_"+t.ItemId.Id]=n)}),Storage_update("outlook2_cache_conversation_item_emailtracker_ids",JSON.stringify(window.cache_conversation_item_emailtracker_ids)),d())}catch(e){Error_report(327,"Outlook2 item fetch error Email Tracker. Please contact us for a fix: "+e,t)}},{post:JSON.stringify({__type:"GetItemJsonRequest:#Exchange",Header:{__type:"JsonRequestHeaders:#Exchange",RequestServerVersion:"V2018_01_08",TimeZoneContext:{__type:"TimeZoneContext:#Exchange",TimeZoneDefinition:{__type:"TimeZoneDefinitionType:#Exchange",Id:"Pacific Standard Time"}}},Body:{__type:"GetItemRequest:#Exchange",ItemShape:{__type:"ItemResponseShape:#Exchange",BaseShape:"IdOnly",AdditionalProperties:[{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"6edab709-7fed-4c7a-a77e-33831fd504cf",PropertyName:"emailtracker_idv",PropertyType:"String"}]},ItemIds:l,ShapeName:null}}),headers:{Action:"GetItem","X-OWA-CANARY":Cookie_get("X-OWA-CANARY"),"content-type":"application/json"}}):d())}),window.cache_id_detection=[],window.cache_id_deletion=[],window.cache_conversation_item_emailtracker_ids={},Storage_get("outlook2_cache_conversation_item_emailtracker_ids",function(e){e&&(window.cache_conversation_item_emailtracker_ids=JSON.parse(e))}),setInterval(function(){DISCONNECTED||(window.cache_id_detection.forEach(function(e){~window.location.href.indexOf("/sentitems")&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_deletion.forEach(function(e){document.querySelectorAll("[data-emailtracker-"+e+"]").forEach(function(e){e.parentNode.removeChild(e)})}))},200)):~window.location.href.indexOf("mail.yahoo.com/neo")||~window.location.host.indexOf("mail.yahoo.com")&&~window.location.href.indexOf("src=neo")||~window.location.href.indexOf("mail.yahoo.com")&&document.querySelector("html#Stencil")?(Script_inject(chrome.extension.getURL("lib/yahoo.js")),Tracker(function(t){Variable("NeoConfig.V3MailboxEmail",function(e){t(e)})},function(s,d){function n(c){Variable("NeoConfig.V3MailboxId",function(r){Variable("NeoConfig.wssid",function(o){Tracker_insert(s,c.parentNode.parentNode.parentNode.parentNode.querySelector("#rtetext"),c,function(t,n){try{c.parentNode.parentNode.parentNode.parentNode.querySelector(".icon-close").addEventListener("click",function(){n=1},!0),document.addEventListener("keydown",function(e){27===e.keyCode&&(n=1)},!0)}catch(e){}var a=(a=c.parentNode.parentNode.parentNode.parentNode.querySelector("#subject-field"))?a.value:"",i=[],e=(c.parentNode.parentNode.parentNode.parentNode.querySelectorAll("#to [data-address]").forEach(function(e){var t=e.textContent,e=e.getAttribute("data-address");i.push(t+(t!==e?" <"+e+">":""))}),setInterval(function(){(!c||c.getBoundingClientRect().left<1)&&(clearInterval(e),n||setTimeout(function(){Xtion_request("https://"+window.location.host+"/ws/v3/batch?name=mailbox.sync&appId=YMailNorrin&wssid="+encodeURIComponent(o),function(e){e=JSON.parse(e).result.responses[0].response.result.messages[0].id;Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(t,{id_source:"3_"+e})}),Tracker_feed_info_insert(t,s,d,"3_"+e,a||"(no subject)",location.protocol+"//"+location.host+"/neo/b/message?mid="+encodeURIComponent(e),i)},{post:{batchJson:JSON.stringify({requests:[{id:"GetMessageGroupList",uri:"/ws/v3/mailboxes/@.id=="+r+"/messages/@.select==q?q="+encodeURIComponent("folderId:2 -folderType:(SYNC)-folderType:(INVISIBLE) count:1 offset:0 -sort:date"),method:"GET",payloadType:"embedded"}],responseType:"json"})},headers:{accept:"application/json","x-specify-origin":window.location.origin}})},1500))},100))})})})}var t;window.emailtracker_keydown||(window.emailtracker_keydown=1,window.addEventListener("keydown",function(e){Tracker_send(function(){var t=0;document.querySelectorAll('span[data-action="send"]').forEach(function(e){0<e.getBoundingClientRect().left&&(t=e)}),t&&(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),n(t))})},!0)),document.querySelectorAll('span[data-action="send"]').forEach(function(t){t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(t),t.addEventListener("click",function(e){Tracker_send(function(){t.getAttribute("data-emailtracker_loaded")||(e.stopPropagation(),e.preventDefault(),n(t))},t)}))});document.querySelector(".btn-sent[aria-selected=true]")&&(t=[],document.querySelectorAll("[data-mid]").forEach(function(e){e.getAttribute("data-emailtracker")||(e.setAttribute("data-emailtracker","1"),e.getAttribute("data-mid")&&(t.push(e.getAttribute("data-mid")),t.push(e.getAttribute("data-mid").replace("-","+"))))}),t.length)&&Request_background(LOCATION_ACTION+"emails_threads_yahoo",function(e){JSON.parse(e).forEach(function(e){var t=(document.querySelector('[data-mid="'+e.id_source.split("_").pop()+'"]')||document.querySelector('[data-mid="'+e.id_source.split("_").pop().replace("+","-")+'"]')).querySelector(".thread-date");t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),t.innerHTML='<span title="'+t.title+'">'+t.innerHTML+"</span>",t.title="",t.insertAdjacentHTML("afterBegin",Tracker_icon(e)))})},{post:{emails:t}}),window.emailtracker_yahoo_initialized||(window.emailtracker_yahoo_initialized=1,Variable("NeoConfig.wssid",function(c){Variable("NeoConfig.V3MailboxId",function(e){document.addEventListener("emailtracker_items",function(e){e=JSON.parse(e.detail.body).result;function t(){setTimeout(function(){document.querySelector(".list-view-items").scrollTop+=1,setTimeout(function(){var e,n=[];r.forEach(function(e,t){n.push("3_"+r[t].mid)}),n.length&&((e=document.querySelectorAll(".cbox[role=gridcell]>input[role=checkbox]")).forEach(function(e,t){t<n.length&&(e.setAttribute("role","checkbox."),e.setAttribute("data-emailtracker",n[t]))}),e.length)&&Request_background(LOCATION_ACTION+"emails?client=yahoo",function(e){JSON.parse(e).forEach(function(e){var t=Xtion_parents(document.querySelector('[data-emailtracker="'+e.id_source+'"]'),3).querySelector(".date");t.getAttribute("data-emailtracker")||t.getAttribute("data-emailtracker-compatibility")||(t.setAttribute("data-emailtracker","1"),t.innerHTML='<span title="'+t.title+'">'+t.innerHTML+"</span>",t.title="",t.insertAdjacentHTML("afterBegin",Tracker_icon(e)))})},{post:{emails:n}})},300)},500)}var i,o,r=[];e.conversations?(i=[],o=[],Storage_get("cache_yahoo_conversations",function(a){var n;a=a||{},e.conversations.forEach(function(e,t){if(e=e.conversation,i.push(e.cid),1<e.summary.totalMsgs)a[e.cid]&&a[e.cid].total===e.summary.totalMsgs?r[t]={mid:a[e.cid].last}:o.push(e.cid);else{e.messageInfo.reverse();try{e.messageInfo.forEach(function(e){if("Sent"===e.sourceFolderInfo.fid)throw r[t]=e,{}})}catch(e){}}}),o.length?(n="",o.forEach(function(e,t){n+='{"id":"LMT_'+t+'","method":"POST","payloadType":"embedded","uri":"/ws/mail/v2.0/jsonrpc","payload":{"method":"ListMessagesInThread","params":[{"fid":"Sent","cid":"'+e+'"}]}},'}),n=n.slice(0,-1),Xtion_request("https://"+window.location.host+"/ws/v3/batch?appid=YahooMailNeo&wssid="+encodeURIComponent(c),function(e){e.split(e.split("\n")[0].trim()).forEach(function(e){e=e.split("\n{");if(e[1]&&(e=JSON.parse("{"+e[1])).result){var t=e.result.conversation.cid,n=e.result.conversation.summary.totalMsgs;(e=e.result.messageInfo).reverse();try{e.forEach(function(e){if("Sent"===e.sourceFolderInfo.fid)throw r[i.indexOf(t)]=e,a[t]={total:n,last:e.mid},{}})}catch(e){}}}),Storage_update("cache_yahoo_conversations",a),t()},{post:'{"requests":['+n+"]}",headers:{"content-type":"application/json"}})):t()})):(r=e.messageInfo,t())}),document.addEventListener("emailtracker_items2",function(t){t=JSON.parse(t.detail.body).result.responses[0].response.result;function n(a){setTimeout(function(){document.querySelector(".list-view-items").scrollTop+=1,setTimeout(function(){var e,n=[];i.forEach(function(e,t){n.push(a?"3_"+i[t].uidl:"3_"+i[t].mid)}),n.length&&((e=document.querySelectorAll(".cbox[role=gridcell]>input[role=checkbox]")).forEach(function(e,t){t<n.length&&(e.setAttribute("role","checkbox."),e.setAttribute("data-emailtracker",n[t]))}),e.length)&&Request_background(LOCATION_ACTION+"emails",function(e){JSON.parse(e).forEach(function(e){var t=Xtion_parents(document.querySelector('[data-emailtracker="'+e.id_source),3).querySelector(".date");t.getAttribute("data-emailtracker")||t.getAttribute("data-emailtracker-compatibility")||(t.setAttribute("data-emailtracker","1"),t.innerHTML='<span title="'+t.title+'">'+t.innerHTML+"</span>",t.title="",t.insertAdjacentHTML("afterBegin",Tracker_icon(e)))})},{post:{emails:n}})},300)},500)}var i=[];t.conversations?Storage_get("cache_yahoo_conversations",function(e){t.conversations.forEach(function(n,a){t.messages.forEach(function(e){var t=e.headers.date;e.conversationId===n.id&&2==e.folder.id&&(!i[a]||t>i[a].date)&&(i[a]={date:t,uidl:e.id})})}),n(1)}):(i=t.messages,n(1))})})}))}),document.documentElement.classList.add("emailtracker_yahoo")):~window.location.host.indexOf("mail.yahoo.com")&&(Script_inject(chrome.extension.getURL("lib/yahoo2.js")),window.emailtracker_yahoo_sent_conversations_last_message_id={},state_load=function(){Variable("AppState.reduxState.action.messageGroupList?AppState:null",function(e){2==e.reduxState.action.folderId&&e.reduxState.action.messageGroupList.forEach(function(e){window.emailtracker_yahoo_sent_conversations_last_message_id[e.id]=e.messages[0].id})})},"complete"===document.readyState?state_load():document.addEventListener("DOMContentLoaded",state_load),document.addEventListener("emailtracker_items",function(e){e=JSON.parse(e.detail.body).result.responses[1].response.result.conversations;e.length&&e.forEach(function(e){~e.folderIds.indexOf("2")&&(window.emailtracker_yahoo_sent_conversations_last_message_id[e.id]=e.messageIds.pop())})}),Tracker(function(t){Variable("AppState.reduxState.mailboxes.accounts[1].email",function(e){t(e)})},function(d,l){Variable("AppState.reduxState.mailboxes.id",function(s){Variable("AppBootstrapData.mailboxAttributes['web.enableConversations']['value']",function(n){function a(r){var c=Xtion_parents(r,4);Variable("AppBootstrapData.mailWssid",function(o){Tracker_insert(d,c.querySelector('[data-test-id="rte"]'),r,function(t,e){var n,a,i;c.querySelector('[data-test-id="richtext-on"]')?Xtion_popup_temporary("Sent Email Untracked - Rich text mode must be enabled to enable tracking. To disable this warning turn on rich text mode or disable email tracker. Click here to learn how to enable rich text mode",{container_click:function(){window.open(LOCATION_MAIN+"help/yahoo-enable-rich-text-mode")}}):(n=(n=r.parentNode.parentNode.parentNode.parentNode.querySelector('[data-test-id="compose-subject"]'))?n.value:"",a=[],r.parentNode.parentNode.parentNode.parentNode.querySelectorAll('[data-test-id="compose-header-field-to"] [title*="@"]').forEach(function(e){a.push(e.getAttribute("title"))}),i=setInterval(function(){(!r||r.getBoundingClientRect().left<1)&&(clearInterval(i),e||setTimeout(function(){Xtion_request("https://"+window.location.host+"/ws/v3/batch?name=folderChange.getList&appId=YMailNorrin&wssid="+encodeURIComponent(o),function(e){e=JSON.parse(e).result.responses[0].response.result.messages[0].id;Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(t,{id_source:"3_"+e})}),Tracker_feed_info_insert(t,d,l,"3_"+e,n||"(no subject)","https://"+location.host+"/d/folders/2/messages/"+encodeURIComponent(e),a)},{post:{batchJson:JSON.stringify({requests:[{id:"GetMessageGroupList",uri:"/ws/v3/mailboxes/@.id=="+s+"/messages/@.select==q?q="+encodeURIComponent("folderId:2 -folderType:(SYNC)-folderType:(INVISIBLE) count:1 offset:0 -sort:date"),method:"GET",payloadType:"embedded"}],responseType:"json"})},headers:{accept:"application/json","x-specify-origin":window.location.origin}})},1500))},100))})})}var i,o;window.emailtracker_keydown||(window.emailtracker_keydown=1,window.addEventListener("keydown",function(e){Tracker_send(function(){var t=0;document.querySelectorAll('[data-test-id="compose-send-button"]').forEach(function(e){0<e.getBoundingClientRect().left&&(t=e)}),t&&(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),a(t))})},!0)),document.querySelectorAll('[data-test-id="compose-send-button"]').forEach(function(t){t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(t),t.addEventListener("click",function(e){Tracker_send(function(){t.getAttribute("data-emailtracker_loaded")||(e.stopPropagation(),e.preventDefault(),a(t))},t)}))});0===location.pathname.indexOf("/d/folders/2")&&(i=[],o=[],document.querySelectorAll('a[data-test-id="message-list-item"]').forEach(function(e){var t;!e.getAttribute("data-emailtracker")&&e.getAttribute("href")&&(e.setAttribute("data-emailtracker","1"),~e.getAttribute("href").indexOf("?")?i.push("3_"+e.getAttribute("href").split("?")[0].split("/").pop()):~e.getAttribute("href").indexOf("/folders/2/messages/")&&(n?(t=e.getAttribute("href").split("folders/2/messages/")[1])&&window.emailtracker_yahoo_sent_conversations_last_message_id[t]&&(o["3_"+window.emailtracker_yahoo_sent_conversations_last_message_id[t]]=t,i.push("3_"+window.emailtracker_yahoo_sent_conversations_last_message_id[t])):i.push("3_"+e.getAttribute("href").split("folders/2/messages/")[1])))}),i.length)&&Request_background(LOCATION_ACTION+"emails",function(e){JSON.parse(e).forEach(function(e){var t=document.querySelector('a[data-test-id="message-list-item"][href*="'+e.id_source.replace("3_","")+'"]'+(o[e.id_source]?',a[data-test-id="message-list-item"][href*="/folders/2/messages/'+o[e.id_source]+'"]':',a[data-test-id="message-list-item"][href*="/folders/2/messages/'+e.id_source.replace("3_","")+'"]')).querySelector('[data-test-id="message-subject"]');t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),t.insertAdjacentHTML("afterBegin",Tracker_icon(e)+" "))})},{post:{emails:i}})})})}),document.documentElement.classList.add("emailtracker_yahoo2")),xtion.loading='<img src="'+chrome.extension.getURL("image/loading_white.gif")+'" alt="Loading.."/>',chrome.runtime.onMessage.addListener(function(t,e,n){Variable("(window.top===window)",function(e){!e||"activated"!==t.a||DISCONNECTED||n(ACTIVATED)})});
