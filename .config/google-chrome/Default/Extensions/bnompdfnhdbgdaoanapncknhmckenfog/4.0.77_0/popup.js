function Initialize(){document.querySelectorAll("[data-onclick]").forEach(function(e){e.onclick||(e.onclick=new Function(e.getAttribute("data-onclick")))}),document.getElementsByTagName("a").forEach(function(e){var t=e.getAttribute("href");t&&"#"!==t&&!e.getAttribute("data-ini-href")&&(e.setAttribute("data-ini-href","1"),e.setAttribute("data-href",e.href),e.addEventListener("click",function(e){var t=this.getAttribute("data-href");if(t&&"#"!==t)return e.preventDefault(),e.stopPropagation(),chrome.tabs.create({url:t}),!1},!0))}),document.querySelectorAll(".feed_search input").forEach(function(r){r.oninput||(r.oninput=function(){var t,e,i,n,o,a,s=this.value.toLowerCase();this.classList.contains("feed_search_all")||this.classList.contains("feed_search_opened")?(t=this.classList.contains("feed_search_all")?"all":"opened",e=document.getElementById("feed_"+t),i=s.length,n="",Xtion_foreach(e.querySelectorAll(".feed_item"),function(e){n+=e.outerHTML,Xtion_elements_delete(e)}),window["feed_"+t+"_search_before"]||(window["feed_"+t+"_search_before"]=n),i?(window["feed_"+t+"_search_pages"]=[],o="",a=0,window["feed_"+t+"_search"].forEach(function(e){~e.s.toLowerCase().indexOf(s)&&(a<50?(a++,o+=e.v):window["feed_"+t+"_search_pages"].push(e.v))}),e.insertAdjacentHTML("beforeEnd",o),setTimeout(function(){Initialize(),r.focus()},100)):window["feed_"+t+"_search_before"]&&(e.insertAdjacentHTML("beforeEnd",window["feed_"+t+"_search_before"]),setTimeout(function(){Initialize(),r.focus()},100),window["feed_"+t+"_search_before"]=null)):this.parentNode.parentNode.parentNode.querySelectorAll("li").forEach(function(e){e.classList.contains("feed_notice")||(e.style.display=!s||~e.querySelector("a").textContent.toLowerCase().indexOf(s)||~e.querySelector("[data-search]").getAttribute("data-search").toLowerCase().indexOf(s)?"":"none")})})}),document.getElementById("feed_export").onclick=function(){Xtion_popup_confirm("Do you want to download your emailtracker feed data as a CSV file?",function(e){e&&Storage_get(["feed_info","feed","feed_unopened"],function(o){o.feed_info||(o.feed_info={});var n=(o.feed||[]).concat(o.feed_unopened||[]).filter(function(e){return e}).sort(function(e,t){var i=o.feed_info[e.id_source],n=o.feed_info[t.id_source],i=parseInt(!e.unopened||!i&&e.time?e.time:i?i.timestamp:0)||0,e=parseInt(!t.unopened||!n&&e.time?t.time:n?n.timestamp:0)||0;return i<e?-1:e<i?1:0});n.reverse(),n.forEach(function(e,t){var i=o.feed_info[e.id_source];delete n[t].id_source,n[t].from=e.user,delete n[t].user,n[t]["last opened"]=e.time?moment.unix(e.time).format():"",delete n[t].time,n[t].views=e.views||0,i&&(n[t].subject=i.subject,n[t].to=i.to?i.to.join(" "):"",n[t]["send date"]=i.timestamp?moment.unix(i.timestamp).format():"")}),n.length&&Download_file_from_string("emailtracker_feed_data.csv",Papa.unparse(n,{quotes:!0,escapeFormulae:!0}))})})}}function Download_file_from_string(e,t){var i=document.createElement("a"),t=new Blob([t],{type:"text/plain;charset=UTF-8"});i.href=window.URL.createObjectURL(t),i.download=e,i.style.display="none",document.body.appendChild(i),i.click()}function Open(e){chrome.tabs.create({url:e})}Initialize(),xtion.hook={Xtion_popup:{end:function(){Initialize()}}},chrome.runtime.sendMessage({a:"badge_clear"}),document.querySelectorAll("#navigation>a").forEach(function(e){e.addEventListener("click",function(){var i=this,n=0;document.querySelectorAll("#navigation>a").forEach(function(e,t){e.classList[i===e?(n=t,"add"):"remove"]("selected")}),document.querySelectorAll("#feed>div").forEach(function(e,t){e.classList[n===t?"add":"remove"]("selected"),n===t&&e.querySelector(".feed_search input").focus()})})}),Storage_get("settings",function(e){(e=e||{}).feed_compact?(document.getElementById("feed").style.fontSize="89%",document.head.innerHTML+="\x3c!--suppress CssUnusedSymbol --\x3e<style>.feed_content>li{margin-bottom:4px;padding:4px;}.feed_content>li .feed_item_footer{margin-top:4px;}</style>",document.body.classList.add("feed_compact")):document.body.classList.remove("feed_compact")});var status_interval=setInterval(function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{a:"activated"},function(e){var n;void 0!==e&&(n=document.getElementById("status"),e?(clearInterval(status_interval),setTimeout(function(){window.ACTIVE||(window.ACTIVE=1,User_is_pro(function(i){Storage_get("tracking_disabled",function(t){Storage_get("tracking_links_disabled",function(e){n.textContent=t?"Tracker Disabled":"Tracker Active",n.className=t?"disabled":"active",document.getElementById("footer_left").innerHTML+=' <a href="#" id="status_toggle" title="Toggle Tracking" data-onclick="Toggle_tracking()" class="icon ion-toggle'+(t?"":"-filled")+" "+(t?"disabled":"active")+'"></a> &emsp; '+(i?'<a href="#" data-onclick="Toggle_tracking_links()" id="status_tracker_links" class="'+(e?"in":"")+'active" title="Toggle Link Tracking">Link Tracker <i class="icon ion-toggle'+(e?"":"-filled")+'"></i></a>':""),setTimeout(function(){document.getElementById("status").removeAttribute("data-ini-click"),Initialize()},100)})})}))},50)):(n.textContent="Tracker Loading",n.className="loading"))})})},250);function Feed(e){Storage_update("feed_updated","0");var t=["feed_info","feed_mute","feed","feed_unopened","feed_clicks"];Storage_get(t,function(g){t.forEach(function(e){g[e]||(g[e]=[])});var w=' &nbsp; (<a href="#" data-onclick="Xtion_popup_alert(\'If you cleared extension data or reinstalled the extension then it will delete all email tracker data and all old email views will not show email details such as subject or recipients. You will have to click on the &quot;An email&quot; link to find out the email that was viewed. If none of these apply to you please contact us at info@emailtracker.website. Email clients can sometimes change things that may break parts of the extension.\')">Why are email subjects missing?</a>)';setTimeout(function(){g.feed_unopened.forEach(function(e,t){e&&(g.feed_unopened[t].unopened=!0)});var e=(g.feed||[]).concat(g.feed_unopened||[]).filter(function(e){return e}).sort(function(e,t){var i=g.feed_info[e.id_source],n=g.feed_info[t.id_source],i=parseInt(!e.unopened||!i&&e.time?e.time:i?i.timestamp:0)||0,e=parseInt(!t.unopened||!n&&e.time?t.time:n?n.timestamp:0)||0;return i<e?-1:e<i?1:0}),r=document.getElementById("feed_all"),t=r.querySelector(".feed_notice_empty");if(e&&e.length){e.reverse();function i(e,t){if(e)if(c&&50<=t||!c&&t<50){var i=g.feed_info[e.id_source],n=0,o=((i=i||{}).subject||(i.subject="An email",n=1),Tracker_email_link_corrections(i.link)||Tracker_email_link(e.id_source,e.user,e.id)),a=g.feed_mute?~g.feed_mute.indexOf(e.id_source):0,s=e.unopened||!e.time?i.timestamp:e.time,s=(c||Xtion_foreach(r.querySelectorAll(".feed_item"),function(e){Xtion_elements_delete(e)}),'<li class="feed_item" data-id="'+Xtion_html_special_chars(e.id_source)+'" style="'+(e.unopened?"":"background:#dfffdf;")+'"><div><strong class="feed_item_title" title="Click to Expand" data-onclick="this.classList.add(\'open\')" data-search="'+Xtion_html_special_chars(i.email||"")+" "+(i.to?Xtion_html_special_chars(i.to.join(" "),!0):"")+'">'+(i.to?Xtion_html_special_chars(i.to.join(", "),!0):"")+'</strong><time class="feed_item_date" style="float:right;font-size:12px;color:#89969b">'+moment.unix(s).format("MMMM D"+(s>new Date("01-01-"+(new Date).getFullYear()).getTime()/1e3?"":", YYYY"))+"</time></div><div><a "+(o?'href="'+Xtion_html_special_chars(o)+'"':" data-onclick=\"Error_report(410);Xtion_popup_alert('"+__("error_feed_info")+"')\"")+' class="feed_item_subject">'+Xtion_html_special_chars(i.subject)+"</a>"+(e.unopened?(n?w:"")+" was <span data-onclick=\"if(event.detail===4){Xtion_popup_prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(e.id_source)+'\')}">sent</span> <span class="Moment_date_pretty">'+i.timestamp+"</span>":(n?w:"")+" was "+(1<e.views?"last ":"")+"<span data-onclick=\"if(event.detail===4){Xtion_popup_prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(e.id_source)+'\')}">opened</span> <span class="Moment_date_pretty">'+e.time+"</span>")+' <div class="feed_item_footer">'+(e.unopened?'<a href="#" data-onclick="Xtion_popup(\''+Xtion_html_special_chars('<strong>Email Not Yet Read</strong><p style="width:100%;margin: 10px 0!important;white-space:normal;">This email\\\'s tracker was not yet triggered. Tracking will work in most cases but if the recipients email client blocks images the tracking will not be able to detect if the recipient opened the email.'+(i.email&&~i.email.indexOf("gmail.com")?"":" If you open your own email with email tracker it will not become read, to test the extension send to another email account.")+'</p><a href="'+LOCATION_MAIN+'help" target="_blank">click here for more details &amp; help</a>')+'\')"><span style="color:#000;">Unopened</span></a>':'<a href="#" data-onclick="Feed_item_load(this.firstChild,'+Xtion_html_special_chars(JSON.stringify({from:i.email,date_sent:i.timestamp}))+',this.parentNode.lastChild,this.parentNode.parentNode.parentNode.getAttribute(\'data-id\'))"><span class="icon ion-chevron-down feed_item_details"></span> <span style="color:#000;">'+parseInt(e.views)+" Open"+(1==e.views?"":"s")+" / Click"+(1==e.views?"":"s")+"</span></a>")+"<div class=\"feed_item_sub\" style=\"float:right;\"><a href=\"#\" data-onclick=\"var e=this;Storage_get('warning_mute',function(warning_mute){Xtion_popup_confirm(warning_mute?null:'Are you sure you want to '+e.lastChild.textContent.toLowerCase()+' this email tracker? You will no longer receive notifications for this email.',function(c){if(c){Storage_update('warning_mute',1);Feed_item_mute_toggle('"+Xtion_html_special_chars(e.id_source)+'\',e.lastChild)}})})" title="Prevent Further Notifications For This Email"><i class="ion ion-android-volume-off"></i> <span>'+(a?"Unm":"M")+'ute</span></a></div> <div></div></div></div><a class="close" href="#" title="Remove Notification" data-onclick="Feed_item_remove(\'feed'+(e.unopened?"_unopened":"")+"',this.parentNode)\">&times;</a></li>");t<50?l+=s:c&&(window.feed_all_pages=window.feed_all_pages||[],window.feed_all_pages.push(s)),window.feed_all_search=window.feed_all_search||[],window.feed_all_search.push({s:i.subject+" "+i.email+" "+(i.to?i.to.join(" "):""),v:s})}else if(!c)throw BreakException}var l="",c=0;try{e.forEach(i)}catch(e){if(e!==BreakException)throw e}setTimeout(function(){c=1,e.forEach(i)},100),t.style.display="none",r.innerHTML+=l,setTimeout(Initialize,100),r.querySelector(".feed_search input").focus(),r.addEventListener("scroll",function(){r.getAttribute("feed-pagination-loading")||90<=100*this.scrollTop/(this.scrollHeight-this.clientHeight)&&(r.setAttribute("feed-pagination-loading",1),r.insertAdjacentHTML("beforeEnd",(document.querySelector(".feed_search_all").value.length?window.feed_all_search_pages:window.feed_all_pages).splice(0,50).join("")),setTimeout(function(){Initialize(),r.removeAttribute("feed-pagination-loading")},100))})}else t.style.display=""},10),setTimeout(function(){var e=(g.feed||[]).filter(function(e){return e}),r=document.getElementById("feed_opened"),t=r.querySelector(".feed_notice_empty");if(e&&e.length){e.reverse();function i(e,t){if(e)if(c&&50<=t||!c&&t<50){var i=g.feed_info[e.id_source],n=0,o=((i=i||{}).subject||(i.subject="An email",n=1),Tracker_email_link_corrections(i.link)||Tracker_email_link(e.id_source,e.user,e.id)),a=g.feed_mute?~g.feed_mute.indexOf(e.id_source):0,s=e.unopened||!e.time?i.timestamp:e.time,s=(c||Xtion_foreach(r.querySelectorAll(".feed_item"),function(e){Xtion_elements_delete(e)}),'<li class="feed_item" data-id="'+Xtion_html_special_chars(e.id_source)+'" style="background:#dfffdf"><div><strong class="feed_item_title" title="Click to Expand" data-onclick="this.classList.add(\'open\')" data-search="'+Xtion_html_special_chars(i.email||"")+" "+(i.to?Xtion_html_special_chars(i.to.join(" "),!0):"")+'">'+(i.to?Xtion_html_special_chars(i.to.join(", "),!0):"")+'</strong><time class="feed_item_date" style="float:right;font-size:12px;color:#89969b">'+moment.unix(s).format("MMMM D"+(s>new Date("01-01-"+(new Date).getFullYear()).getTime()/1e3?"":", YYYY"))+"</time></div><div><a "+(o?'href="'+Xtion_html_special_chars(o)+'"':" data-onclick=\"Error_report(410);Xtion_popup_alert('"+__("error_feed_info")+"')\"")+' class="feed_item_subject">'+Xtion_html_special_chars(i.subject)+"</a>"+(e.unopened?(n?w:"")+" was <span data-onclick=\"if(event.detail===4){Xtion_popup_prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(e.id_source)+'\')}">sent</span> <span class="Moment_date_pretty">'+i.timestamp+"</span>":(n?w:"")+" was "+(1<e.views?"last ":"")+"<span data-onclick=\"if(event.detail===4){Xtion_popup_prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(e.id_source)+'\')}">opened</span> <span class="Moment_date_pretty">'+e.time+"</span>")+' <div class="feed_item_footer">'+(e.unopened?'<a href="#" data-onclick="Xtion_popup(\''+Xtion_html_special_chars('<strong>Email Not Yet Read</strong><p style="width:100%;margin: 10px 0!important;white-space:normal;">This email\\\'s tracker was not yet triggered. Tracking will work in most cases but if the recipients email client blocks images the tracking will not be able to detect if the recipient opened the email.'+(i.email&&~i.email.indexOf("gmail.com")?"":" If you open your own email with email tracker it will not become read, to test the extension send to another email account.")+'</p><a href="'+LOCATION_MAIN+'help" target="_blank">click here for more details &amp; help</a>')+'\')"><span style="color:#000;">Unopened</span></a>':'<a href="#" data-onclick="Feed_item_load(this.firstChild,'+Xtion_html_special_chars(JSON.stringify({from:i.email,date_sent:i.timestamp}))+',this.parentNode.lastChild,this.parentNode.parentNode.parentNode.getAttribute(\'data-id\'))"><span class="icon ion-chevron-down feed_item_details"></span> <span style="color:#000;">'+parseInt(e.views)+" Open"+(1==e.views?"":"s")+" / Click"+(1==e.views?"":"s")+"</span></a>")+"<div class=\"feed_item_sub\" style=\"float:right;\"><a href=\"#\" data-onclick=\"var e=this;Storage_get('warning_mute',function(warning_mute){Xtion_popup_confirm(warning_mute?null:'Are you sure you want to '+e.lastChild.textContent.toLowerCase()+' this email tracker? You will no longer receive notifications for this email.',function(c){if(c){Storage_update('warning_mute',1);Feed_item_mute_toggle('"+Xtion_html_special_chars(e.id_source)+'\',e.lastChild)}})})" title="Prevent Further Notifications For This Email"><i class="ion ion-android-volume-off"></i> <span>'+(a?"Unm":"M")+'ute</span></a></div> <div></div></div></div><a class="close" href="#" title="Remove Notification" data-onclick="Feed_item_remove(\'feed_opened\',this.parentNode)">&times;</a></li>');t<50?l+=s:c&&(window.feed_opened_pages=window.feed_opened_pages||[],window.feed_opened_pages.push(s)),window.feed_opened_search=window.feed_opened_search||[],window.feed_opened_search.push({s:i.subject+" "+i.email+" "+(i.to?i.to.join(" "):""),v:s})}else if(!c)throw BreakException}var l="",c=0;try{e.forEach(i)}catch(e){if(e!==BreakException)throw e}setTimeout(function(){c=1,e.forEach(i)},100),t.style.display="none",r.innerHTML+=l,setTimeout(Initialize,100),r.querySelector(".feed_search input").focus(),r.addEventListener("scroll",function(){r.getAttribute("feed-pagination-loading")||90<=100*this.scrollTop/(this.scrollHeight-this.clientHeight)&&(r.setAttribute("feed-pagination-loading",1),r.insertAdjacentHTML("beforeEnd",(document.querySelector(".feed_search_opened").value.length?window.feed_opened_search_pages:window.feed_opened_pages).splice(0,50).join("")),setTimeout(function(){Initialize(),r.removeAttribute("feed-pagination-loading")},100))})}else t.style.display="";var n=(g.feed_unopened||[]).filter(function(e){return e}),s=document.getElementById("feed_unopened"),t=s.querySelector(".feed_notice_empty");if(n&&n.length){n.reverse();function o(e,t){if(e)if(_&&50<=t||!_&&t<50){e.unopened=1;var i=g.feed_info[e.id_source],n=0,o=((i=i||{}).subject||(i.subject="An email",n=1),Tracker_email_link_corrections(i.link)||Tracker_email_link(e.id_source,e.user,e.id)),a=g.feed_mute?~g.feed_mute.indexOf(e.id_source):0,o=(_||Xtion_foreach(s.querySelectorAll(".feed_item"),function(e){Xtion_elements_delete(e)}),'<li class="feed_item" data-id="'+Xtion_html_special_chars(e.id_source)+'" style="'+(e.unopened?"":"background:#dfffdf;")+'"><div><strong class="feed_item_title" title="Click to Expand" data-onclick="this.classList.add(\'open\')" data-search="'+Xtion_html_special_chars(i.email||"")+" "+(i.to?Xtion_html_special_chars(i.to.join(" "),!0):"")+'">'+(i.to?Xtion_html_special_chars(i.to.join(", "),!0):"")+'</strong><time class="feed_item_date" style="float:right;font-size:12px;color:#89969b">'+moment.unix(e.unopened?i.timestamp:e.time).format("MMMM D"+((e.unopened?i.timestamp:e.time)>new Date("01-01-"+(new Date).getFullYear()).getTime()/1e3?"":", YYYY"))+"</time></div><div><a "+(o?'href="'+Xtion_html_special_chars(o)+'"':" data-onclick=\"Error_report(410);Xtion_popup_alert('"+__("error_feed_info")+"')\"")+' class="feed_item_subject">'+Xtion_html_special_chars(i.subject)+"</a>"+(e.unopened?(n?w:"")+" was <span data-onclick=\"if(event.detail===4){Xtion_popup_prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(e.id_source)+"')}\">sent</span> "+Moment_date_pretty(moment.unix(i.timestamp)):(n?w:"")+" was "+(1<e.views?"last ":"")+"<span data-onclick=\"if(event.detail===4){Xtion_popup_prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(e.id_source)+"')}\">opened</span> "+Moment_date_pretty(moment.unix(e.time)))+' <div class="feed_item_footer">'+(e.unopened?'<a href="#" data-onclick="Xtion_popup(\''+Xtion_html_special_chars('<strong>Email Not Yet Read</strong><p style="width:100%;margin: 10px 0!important;white-space:normal;">This email\\\'s tracker was not yet triggered. Tracking will work in most cases but if the recipients email client blocks images the tracking will not be able to detect if the recipient opened the email.'+(i.email&&~i.email.indexOf("gmail.com")?"":" If you open your own email with email tracker it will not become read, to test the extension send to another email account.")+'</p><a href="'+LOCATION_MAIN+'help" target="_blank">click here for more details &amp; help</a>')+'\')"><span style="color:#000;">Unopened</span></a>':'<a href="#" data-onclick="Feed_item_load(this.firstChild,'+Xtion_html_special_chars(JSON.stringify({from:i.email,date_sent:i.timestamp}))+',this.parentNode.lastChild,this.parentNode.parentNode.parentNode.getAttribute(\'data-id\'))"><span class="icon ion-chevron-down feed_item_details"></span> <span style="color:#000;">'+parseInt(e.views)+" Open"+(1==e.views?"":"s")+" / Click"+(1==e.views?"":"s")+"</span></a>")+"<div class=\"feed_item_sub\" style=\"float:right;\"><a href=\"#\" data-onclick=\"var e=this;Storage_get('warning_mute',function(warning_mute){Xtion_popup_confirm(warning_mute?null:'Are you sure you want to '+e.lastChild.textContent.toLowerCase()+' this email tracker? You will no longer receive notifications for this email.',function(c){if(c){Storage_update('warning_mute',1);Feed_item_mute_toggle('"+Xtion_html_special_chars(e.id_source)+'\',e.lastChild)}})})" title="Prevent Further Notifications For This Email"><i class="ion ion-android-volume-off"></i> <span>'+(a?"Unm":"M")+'ute</span></a></div> <div></div></div></div><a class="close" href="#" title="Remove Notification" data-onclick="Feed_item_remove(\'feed_unopened\',this.parentNode)">&times;</a></li>');t<50?d+=o:_&&(window.feed_unopened_pages=window.feed_unopened_pages||[],window.feed_unopened_pages.push(o)),window.feed_unopened_search=window.feed_unopened_search||[],window.feed_unopened_search.push({s:i.subject+" "+i.email+" "+(i.to?i.to.join(" "):""),v:o})}else if(!_)throw BreakException}var d="",_=0;try{n.forEach(o)}catch(e){if(e!==BreakException)throw e}setTimeout(function(){_=1,n.forEach(o)},100),t.style.display="none",s.innerHTML+=d,setTimeout(Initialize,100),s.querySelector(".feed_search input").focus(),s.addEventListener("scroll",function(){s.getAttribute("feed-pagination-loading")||90<=100*this.scrollTop/(this.scrollHeight-this.clientHeight)&&(s.setAttribute("feed-pagination-loading",1),s.insertAdjacentHTML("beforeEnd",(document.querySelector(".feed_search_unopened").value.length?window.feed_unopened_search_pages:window.feed_unopened_pages).splice(0,50).join("")),setTimeout(function(){Initialize(),s.removeAttribute("feed-pagination-loading")},100))})}else t.style.display="";var a=(g.feed_clicks||[]).filter(function(e){return e}),u=document.getElementById("feed_clicks"),t=u.querySelector(".feed_notice_empty"),p=u.querySelector(".feed_notice_pro");if(a&&a.length){a.reverse();function f(e,t){if(e)if(h&&50<=t||!h&&t<50){var i=g.feed_info[e.id_source],n=0,o=((i=i||{}).subject||(i.subject="An email",n=1),Tracker_email_link_corrections(i.link)||Tracker_email_link(e.id_source,e.user,e.id)),a=g.feed_mute?~g.feed_mute.indexOf(e.id_source):0,n=(h||Xtion_foreach(u.querySelectorAll(".feed_item"),function(e){Xtion_elements_delete(e)}),'<li class="feed_item" data-id="'+Xtion_html_special_chars(e.id_source)+'" style="background:#dfffdf"><div><strong class="feed_item_title" title="Click to Expand" data-onclick="this.classList.add(\'open\')" data-search="'+Xtion_html_special_chars(i.email||"")+" "+(i.to?Xtion_html_special_chars(i.to.join(" "),!0):"")+'">'+(i.to?Xtion_html_special_chars(i.to.join(", "),!0):"")+'</strong><time class="feed_item_date" style="float:right;font-size:12px;color:#89969b">'+moment.unix(e.unopened?i.timestamp:e.time).format("MMMM D"+((e.unopened?i.timestamp:e.time)>new Date("01-01-"+(new Date).getFullYear()).getTime()/1e3?"":", YYYY"))+'</time></div><div><a href="'+Xtion_html_special_chars(e.link)+'">'+Xtion_html_special_chars(e.link)+"</a>"+(n?w:"")+" was <span data-onclick=\"if(event.detail===4){Xtion_popup_prompt('Copy the email debug information below and send to us when necessary:','"+Xtion_html_special_chars(e.id_source)+"')}\">clicked</span> in the email <a "+(o?'href="'+Xtion_html_special_chars(o)+'"':" data-onclick=\"Error_report(410);Xtion_popup_alert('"+__("error_feed_info")+"')\"")+">"+Xtion_html_special_chars(i.subject)+"</a> "+Moment_date_pretty(moment.unix(e.time))+' <div class="feed_item_footer"><a href="#" data-onclick="Feed_item_load(this.firstChild,'+Xtion_html_special_chars(JSON.stringify({from:i.email,date_sent:i.timestamp}))+',this.parentNode.lastChild,this.parentNode.parentNode.parentNode.getAttribute(\'data-id\'))"><span class="icon ion-chevron-down feed_item_details"></span> <span style="color:#000;">All Opens / Clicks</span></a><div class="feed_item_sub" style="float:right;"><a href="#" data-onclick="var e=this;Storage_get(\'warning_mute\',function(warning_mute){Xtion_popup_confirm(warning_mute?null:\'Are you sure you want to \'+e.lastChild.textContent.toLowerCase()+\' this email tracker? You will no longer receive notifications for this email.\',function(c){if(c){Storage_update(\'warning_mute\',1);Feed_item_mute_toggle(\''+Xtion_html_special_chars(e.id_source)+'\',e.lastChild)}})})" title="Prevent Further Notifications For This Email"><i class="ion ion-android-volume-off"></i> <span>'+(a?"Unm":"M")+'ute</span></a></div> <div></div></div></div><a class="close" href="#" title="Remove Notification" data-onclick="Feed_item_remove(\'feed_clicks\',this.parentNode)">&times;</a></li>');t<50?m+=n:h&&(window.feed_clicks_pages=window.feed_clicks_pages||[],window.feed_clicks_pages.push(n)),window.feed_clicks_search=window.feed_clicks_search||[],window.feed_clicks_search.push({s:i.subject+" "+i.email+" "+(i.to?i.to.join(" "):""),v:n})}else if(!h)throw BreakException}var m="",h=0;try{a.forEach(f)}catch(e){if(e!==BreakException)throw e}setTimeout(function(){h=1,a.forEach(f)},100),p.style.display="none",t.style.display="none",u.innerHTML+=m,setTimeout(Initialize,100),u.querySelector(".feed_search input").focus(),u.addEventListener("scroll",function(){u.getAttribute("feed-pagination-loading")||90<=100*this.scrollTop/(this.scrollHeight-this.clientHeight)&&(u.setAttribute("feed-pagination-loading",1),u.insertAdjacentHTML("beforeEnd",(document.querySelector(".feed_search_clicks").value.length?window.feed_clicks_search_pages:window.feed_clicks_pages).splice(0,50).join("")),setTimeout(function(){Initialize(),u.removeAttribute("feed-pagination-loading")},100))})}else t.style.display="",User_is_pro(function(e){p.style.display=e?"none":""})},500)})}function Feed_item_load(t,i,o,a){Storage_get("settings",function(e){e=e||{},t.classList.contains("ion-chevron-down")?(t.classList.remove("ion-chevron-down"),t.classList.add("ion-chevron-up"),o.innerHTML='<img src="image/loading.gif" alt="Loading.."/>',Xtion_request(LOCATION_ACTION+"email_views?id_source="+encodeURIComponent(a),function(n){n?(n=JSON.parse(n),o.innerHTML=n instanceof Array?Tracker_parse_email_views(n,e)+'<div style="text-align:center;font-weight:700;font-style:normal;margin-top:8px;">'+(i.date_sent?"<div>Sent "+Xtion_html_special_chars(i.from?"from "+i.from+" ":"")+Moment_date_pretty(moment.unix(i.date_sent))+'</div><div style="margin-top:6px;">Opened in '+moment.duration(moment.unix(i.date_sent).diff(moment.unix(n[n.length-1].timestamp))).humanize()+"</div>":"")+"<div style=\"margin-top:9px;\"><a href=\"#\" data-onclick=\"var e=Xtion_parents(this,'.feed_item').querySelector('.close');Xtion_popup_confirm('Are you sure you want to mark this email tracker as unread? This is used for false positives or notification of the next view.',function(r){if(r){Xtion_request('"+LOCATION_ACTION+"email_unread?id_source="+Xtion_html_special_chars(encodeURIComponent(a))+'\',function(){Xtion_popup_alert(\'Email marked unread. You will be notified of the next open.\');e.click()},{loading_overlay:1})}})" title="Use for false positives or for notification of the next view for this email."><i class="ion-email-unread"></i> Mark Unread</a> &nbsp; <a href="#" data-onclick="window.open(LOCATION_MAIN+\'user/email_report.php?id_source='+encodeURIComponent(a)+'\')"><i class="icon ion-printer"></i> Print</a></div></div>':'<a href="'+LOCATION_MAIN+'pro?source=feed_read_report" target="_blank"><img src="image/upgrade.jpg" alt="Upgrade to Pro" style="width:100%;margin-top:15px"/></a>',setTimeout(Initialize,100),setTimeout(function(){Storage_get(["feed","feed_unopened"],function(i){var t=n.views||n.length;i.feed=i.feed.filter(function(e){return e}),i.feed_unopened=i.feed_unopened.filter(function(e){return e}),(i.feed_unopened||[]).forEach(function(e,t){i.feed_unopened[t].unopened=1,i.feed_unopened[t].unopened_key=t}),(i.feed||[]).concat(i.feed_unopened||[]).forEach(function(e){e&&e.id_source===a&&e.views!=t&&(e.views=t,e.time=n.last||n[0].timestamp,e.unopened&&(i.feed_unopened.splice(e.unopened_key,1),Storage_update("feed_unopened",i.feed_unopened),delete e.unopened,delete e.unopened_key,i.feed.push(e)),Storage_update("feed",i.feed))})})},0)):o.innerHTML='<div style="text-align:center;color:#f00;font-weight:700;">Error. Please contact us for help.</div>'})):(t.classList.remove("ion-chevron-up"),t.classList.add("ion-chevron-down"),o.innerHTML="")})}function Feed_item_remove(n,e){var o=e.getAttribute("data-id");Xtion_elements_delete(e),Storage_get(n,function(i){try{i.forEach(function(e,t){if(e&&e.id_source===o)throw i.splice(t,1),Storage_update(n,i),{}})}catch(e){}})}function Feed_empty(e,t){Storage_update(e,null);t=t||document.getElementById(e);Xtion_foreach(t.querySelectorAll(".feed_item"),function(e){Xtion_elements_delete(e)}),t.querySelector(".feed_notice_empty").style.display=""}function Feed_item_mute_toggle(i,n){Storage_get("feed_mute",function(e){var t=(e=e||[]).indexOf(i);~t?(e.splice(t,1),n.textContent="Mute"):(e.push(i),n.textContent="Unmute"),Storage_update("feed_mute",e)})}function Toggle_tracking(){Storage_get("tracking_disabled",function(e){Storage_update("tracking_disabled",e?0:1);var t=document.getElementById("status");t.textContent=e?"Tracker Active":"Tracker Disabled",t.className=e?"active":"disabled",document.getElementById("status_toggle").className="icon ion-toggle"+(e?"-filled active":" inactive")})}function Toggle_tracking_links(){Storage_get("tracking_links_disabled",function(e){Storage_update("tracking_links_disabled",e?0:1);var t=document.getElementById("status_tracker_links");t.className=e?"active":"inactive",t.querySelector(".icon").className="icon ion-toggle"+(e?"-filled":"")})}User_is_pro(function(e){var t=document.getElementById("edition");t.className=1==e?"active":"inactive",e||(t=document.getElementById("status_tracker_links"))&&(t.style.display="none")},!0),Storage_get("notifications_disabled",function(e){function t(e){var t=document.getElementById("feed_notice_disabled");e?t||document.getElementById("feed_all").insertAdjacentHTML("afterBegin",'<li id="feed_notice_disabled" class="feed_notice">Notifications are disabled. You will not receive any more notifications.</li>'):t&&t.parentNode.removeChild(t)}var i=document.getElementById("notifications_toggle"),n=i.querySelector("i");e&&(n.className="icon ion-toggle");t(e),i.addEventListener("click",function(){var e=n.classList.contains("ion-toggle-filled");Storage_update("notifications_disabled",e?1:0),n.className="icon ion-toggle"+(e?"":"-filled"),t(e)})}),setTimeout(Feed,0),setInterval(function(){Storage_get("feed_updated",function(e){1==e&&Feed()})},1e3),document.getElementById("settings").addEventListener("click",function(){User_is_pro(function(t){Storage_get("settings",function(e){var i;document.querySelector("#settings_form")||(e=e||{},i=Xtion_popup("<h2>"+(t?"Pro ":"Basic ")+'Settings</h2><form action="javascript:" id="settings_form">'+(t?'<label><span>Desktop Notifications</span> <input type="hidden" name="notifications_desktop" value="0"/><input name="notifications_desktop" value="1" type="checkbox" '+(e.notifications_desktop?" checked":"")+'/></label><label><span>Email Notifications</span> <input name="notifications_email" type="email" placeholder="your email for notifications" value="'+Xtion_html_special_chars(e.notifications_email)+'"/></label><label><span>Email / desktop notifications for all views <a href="#" class="icon ion-information-circled" data-onclick="Xtion_popup_alert(\'Email and desktop notifications are only sent when an email is first viewed by default. If you want to get notified of every repeat view then you can check this. You may receive a lot of notifications depending on the amount of views you get.\')"></a></span> <input type="hidden" name="notifications_extra_all" value="0"/><input name="notifications_extra_all" value="1" type="checkbox" '+(e.notifications_extra_all?" checked":"")+'/></label><label><span>Email / desktop notifications for all link clicks <a href="#" class="icon ion-information-circled" data-onclick="Xtion_popup_alert(\'Notifies you of all link clicks even repeat ones.\')"></a></span> <input type="hidden" name="notifications_extra_links" value="0"/><input name="notifications_extra_links" value="1" type="checkbox" '+(e.notifications_extra_links?" checked":"")+'/></label><label><span>Show "Send without link tracking" button <a href="#" class="icon ion-information-circled" data-onclick="Xtion_popup_alert(\'Show a &quot;Send without link tracking&quot; button beside the send button when composing an email to send emails quickly without link tracking.\')"></a></span> <input type="hidden" name="button_send_disable_tracking_links" value="0"/><input name="button_send_disable_tracking_links" value="1" type="checkbox" '+(e.button_send_disable_tracking_links?" checked":"")+'/></label><label><span>Custom IP Website <a href="#" class="icon ion-information-circled" data-onclick="Xtion_popup_alert(\'Enter the website you want to use for IP information. Replace the IP already in the URL with &quot;{ip}&quot;. For example the URL &quot;https://geoiptool.com/en/?ip=1.2.3.4&quot; would become &quot;https://geoiptool.com/en/?ip={ip}&quot;\')"></a></span> <input name="ip_website" type="url" placeholder="Custom IP Website URL" value="'+Xtion_html_special_chars(e.ip_website)+'"/></label><label><span>Additional Tracking Pixels <a href="#" class="icon ion-information-circled" data-onclick="Xtion_popup_alert(\'Enter the additional tracking pixels you want added to your tracked emails. These can be tracking pixels like the Facebook pixel or Google Adwords Pixel and any other tracking pixel. Must only be the image tracking pixel. The image tracking pixels should look like &quot;&amp;lt;img src=&quot;TRACKING_LINK&quot;/&amp;gt;&quot;. If you do not enter the image tracking pixels correctly your email contents may be affected and you will need to correct it here. Please note if the user\\\'s email client proxies tracking pixels then it will not fire for them.\')"></a></span> <input name="tracking_pixels" type="text" placeholder="Tracking Pixel(s) (Image HTML)" value="'+Xtion_html_special_chars(e.tracking_pixels)+'"/></label>':"")+'<label><span>Hide "Send Untracked" button <a href="#" class="icon ion-information-circled" data-onclick="Xtion_popup_alert(\'Hide the &quot;Send without tracking&quot; button beside the send button when composing an email if you do not use it.\')"></a></span> <input type="hidden" name="button_send_disable_tracking_hide" value="0"/><input name="button_send_disable_tracking_hide" value="1" type="checkbox" '+(e.button_send_disable_tracking_hide?" checked":"")+'/></label><label><span>Compact Feed <a href="#" class="icon ion-information-circled" data-onclick="Xtion_popup_alert(\'Make the feed content smaller and more compact. Setting will apply after you reopen the feed.\')"></a></span> <input type="hidden" name="feed_compact" value="0"/><input name="feed_compact" value="1" type="checkbox" '+(e.feed_compact?" checked":"")+'/></label><a href="#" data-onclick="Xtion_popup_confirm(\'Use if notifications are slow or not working to reset connection to the Google push notification server.\',function(c){if(c){Tracker_notifications_register()}})">Reset Push Notification Registration</a>'+(t?"":'<div><h2 style="\t\t\tfont-size: 18px;\t\t\tmargin-bottom: 8px;">Upgrade for extra features & settings</h2><p style="font-size:16px;margin:0;">Instant Desktop & Email Notifications<br/><img src="image/upgrade_example_notifications.jpg" alt="Upgrade for desktop / email notifications and more professional features" style="display:inline-block;margin:8px 0 4px 0;"/><br/>get notified the instant your emails are opened</p><ul style="  \tmargin: 8px auto 10px auto;\tfont-size:14px;\t\tlist-style: none;\t\t\tpadding-left: 0;"><li>Full Read Reports</li><li>Link Tracking</li><li>Location & Device Information</li><li>And More</li></ul><a href="'+LOCATION_MAIN+'pro?source=feed_settings"><button class="action">Learn More</button></a></div>')+"<br/><br/><button>Save</button></form>"),setTimeout(function(){Initialize(),document.getElementById("settings_form").addEventListener("submit",function(){Storage_get("notify",function(e){e=e||{};var t=Xtion_form_to_json(document.getElementById("settings_form"));Xtion_request(LOCATION_ACTION+"user_setting",function(){Storage_update("settings",t),i.close()},{post:Xtion_object_merge({notify:e.id,notify_push:e.push,email:t.notifications_email,extra:t.notifications_extra_all},t),loading_overlay:1})})})},100))})},!0)});var background=chrome.extension.getBackgroundPage();function Tracker_notifications_register(){var i=Xtion_popup_loading();chrome.instanceID.getToken({authorizedEntity:PUSH_GCM_ID,scope:"GCM"},function(t){chrome.runtime.lastError?(i.close(),Xtion_popup_alert("A GCM registration error occurred, please try again later. If this error persists please contact google about GCM issues. Error: "+JSON.stringify(chrome.runtime.lastError))):Xtion_request(LOCATION_ACTION+"notification_register",function(e){i.close(),"{"===e.substring(0,1)?Storage_update("notify",Xtion_object_merge(JSON.parse(e),{push:t})):Xtion_popup(e)},{post:{id:t}})})}addEventListener("unload",function(e){background.chrome.browserAction.setBadgeText({text:""})},!0),Storage_get("notify",function(e){e||(document.getElementById("feed_all").insertAdjacentHTML("afterBegin",'<li id="feed_notice_unregistered" class="feed_notice">Notifications are not yet enabled. '+(null!=window.navigator.brave&&"isBrave"==window.navigator.brave.isBrave.name?'To enable push notifications for Brave browser please enable the setting "Use Google services for push messaging" in your browser settings page. For more instructions <a href="'+LOCATION_MAIN+'help/brave-enable-google-push-notifications" target="_blank">click here</a>. ':"")+'Please wait a couple seconds for notifications to get registered and close and reopen this popup. If this message does not disappear than try manually registering for notifications by <a href="#" id="feed_notice_unregistered_register">clicking here. If this message still does not go away then your feed will still work but will not be instant and sync at a slower rate and it may get out of sync between sync intervals.</a></li>'),setTimeout(function(){document.getElementById("feed_notice_unregistered_register").onclick=Tracker_notifications_register},100))}),setInterval(function(){document.querySelectorAll(".Moment_date_pretty").forEach(function(e){e.classList.remove("Moment_date_pretty"),e.innerHTML=Moment_date_pretty(moment.unix(e.innerHTML))})},100),xtion.loading='<img src="image/loading_white.gif" alt="Loading.."/>';
