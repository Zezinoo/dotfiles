function Xtion_html_special_chars(e,t){if(null==e)return"";var n=3;t=void 0!==t&&t;var o=0,r=0,i=!1;null==n&&(n=2),e=e.toString(),e=(e=!1!==t?e.replace(/&/g,"&amp;"):e).replace(/</g,"&lt;").replace(/>/g,"&gt;");var a={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===n&&(i=!0),"number"!=typeof n){for(n=[].concat(n),r=0;r<n.length;r++)0===a[n[r]]?i=!0:a[n[r]]&&(o|=a[n[r]]);n=o}return n&a.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),e=!i?e.replace(/"/g,"&quot;"):e}function Xtion_html_entity_decode(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}window.xtion=window.xtion||{},xtion.detection=xtion.detection||{},xtion.scroll_body=xtion.scroll_body||document.documentElement.scrollTop&&document.documentElement||document.body,"function"!=typeof Array.move&&(Array.prototype.move=function(e,t){this.splice(t,0,this.splice(e,1)[0])}),"remove"!=typeof Array.remove&&(Array.prototype.remove=function(){for(var e,t,n=arguments,o=n.length;o&&this.length;)for(e=n[--o];-1!==(t=this.indexOf(e));)this.splice(t,1);return this}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(o=arguments[n]))for(var o=Object(o),r=Object.keys(o),i=0,a=r.length;i<a;i++){var c=r[i],s=Object.getOwnPropertyDescriptor(o,c);void 0!==s&&s.enumerable&&(t[c]=o[c])}return t}}),HTMLCollection.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},NodeList.prototype.forEach=HTMLCollection.prototype.forEach,HTMLOptionsCollection.prototype.forEach=HTMLCollection.prototype.forEach,window.BreakException={};var Xtion_base64_key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Xtion_utf8_encode(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t}function Xtion_utf8_decode(e){var t,n="",o=0;for(c1=c2=0;o<e.length;)(t=e.charCodeAt(o))<128?(n+=String.fromCharCode(t),o++):191<t&&t<224?(c2=e.charCodeAt(o+1),n+=String.fromCharCode((31&t)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),n+=String.fromCharCode((15&t)<<12|(63&c2)<<6|63&c3),o+=3);return n}function Xtion_base64_encode(e){var t,n,o,r,i,a,c="",s=0;for(e=Xtion_utf8_encode(e);s<e.length;)o=(a=e.charCodeAt(s++))>>2,r=(3&a)<<4|(t=e.charCodeAt(s++))>>4,i=(15&t)<<2|(n=e.charCodeAt(s++))>>6,a=63&n,isNaN(t)?i=a=64:isNaN(n)&&(a=64),c=c+Xtion_base64_key.charAt(o)+Xtion_base64_key.charAt(r)+Xtion_base64_key.charAt(i)+Xtion_base64_key.charAt(a);return c}function Xtion_base64_decode(e){var t,n,o,r,i,a,c="",s=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");s<e.length;)o=Xtion_base64_key.indexOf(e.charAt(s++)),t=(15&(r=Xtion_base64_key.indexOf(e.charAt(s++))))<<4|(i=Xtion_base64_key.indexOf(e.charAt(s++)))>>2,n=(3&i)<<6|(a=Xtion_base64_key.indexOf(e.charAt(s++))),c+=String.fromCharCode(o<<2|r>>4),64!=i&&(c+=String.fromCharCode(t)),64!=a&&(c+=String.fromCharCode(n));return Xtion_utf8_decode(c)}function Xtion_select_text(e){var t,n;document.body.createTextRange?((n=document.body.createTextRange()).moveToElementText(e),n.select()):window.getSelection&&(t=window.getSelection(),(n=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(n))}function Xtion_object_merge(e,t){if(e&&t){for(var n in t)t.hasOwnProperty(n)&&!e[n]&&(e[n]=t[n]);return e}return t||e||{}}function Xtion_form_to_json(e,t){if((t=t||{}).name_prefixing=function(e){return(t.prefix||"")+(t.prefix_remove?e.replace(t.prefix_remove,""):e)},"undefined"!=typeof CKEDITOR)for(var n=e.getElementsByClassName("cke"),o=n.length;o--;)(r=CKEDITOR.instances[n[o].id.substr(4)])&&(r.element.$.value=r.getData());for(var r,i,a,c=t.array?[{}]:t.update||{},s=e.elements||e.querySelectorAll("input,textarea,select"),o=0,p=s.length;o<p;o++)s[o].disabled||(r=t.name_prefixing(s[o].name))&&(i=s[o].value,t.selects_use_text&&"SELECT"===s[o].tagName?i=s[o].options[s[o].selectedIndex].text:"INPUT"===s[o].tagName&&"checkbox"===s[o].type?i=s[o].checked?1:0:"SELECT"===s[o].tagName&&s[o].multiple&&(i=[],s[o].options.forEach(function(e){e.selected&&i.push(e.value)})),i=t.modify&&t.modify[r]?t.modify[r](i):i,t.array?(r=r.replace("[]",""),c[c.length-1][r]?((a={})[r]=i,c.push(a)):c[c.length-1][r]=i):"[]"!==r.substr(-2,2)||s[o].multiple?c[r]=i:(c[r]||(c[r]=[]),c[r].push(i)));if(t.array_all){var l=[{}];for(o in c)if(c[o]instanceof Array)for(var u=0;u<c[o].length;u++)l[u]||(l[u]={}),l[u][o.replace("[]","")]=c[o][u];else l[0][o]=c[o];c=l}return c}function Xtion_json_to_form(e,t,n){n=n||{};var o=document.createElement("form");o.action="javascript:",o.onsubmit=function(){e=Xtion_form_to_json(this,{modify:n.modify,update:e}),t&&t(e,o)};var r,i="";for(r in e)if(e.hasOwnProperty(r)&&"string"==typeof e[r])if(n.input&&n.input[r]){var a=n.input[r];if("textarea"===n.input[r]||n.input[r].type&&"textarea"===n.input[r].type)i+="<label>"+r+':<textarea name="'+r+'" class="'+(n.input_classes&&n.input_classes[r]?n.input_classes[r]:"")+'" '+(a.placeholder?' placeholder="'+a.placeholder+'"':"")+">"+Xtion_html_special_chars(e[r])+"</textarea></label>";else if(n.input[r]instanceof Object){var c,s=n.input[r];for(c in i+="<label>"+r+':<select name="'+Xtion_html_special_chars(r)+'">',s)s.hasOwnProperty(c)&&(i+='<option value="'+Xtion_html_special_chars(c)+'"'+(c==e[r]?" selected":"")+">"+Xtion_html_special_chars(s[c])+"</option>");i+="</select></label>"}}else i+="<label>"+r.replace("_"," ")+':<input name="'+r+'" value="'+Xtion_html_special_chars(e[r])+'" type="'+(n.input_types&&n.input_types[r]||"text")+'" class="'+(n.input_classes&&n.input_classes[r]?n.input_classes[r]:"")+'"/></label>';o.innerHTML=(n.prepend||"")+i;var p=document.createElement("input");return p.type="submit",p.value="Submit",o.appendChild(p),o}function Xtion_json_to_form_submit(e,t,n){n=n||{};var o=document.createElement("form");o.setAttribute("action",t),o.setAttribute("method",n.method||"post"),o.className="Xtion_form Xtion_json_to_form_submit",n.pre&&(o.innerHTML+=n.pre);t=document.createElement("div");t.className="Xtion_form_output",o.appendChild(t);var r,i="";for(r in e)if(e.hasOwnProperty(r)&&"string"==typeof e[r])if(n.input&&n.input[r]){var a=n.input[r];if("textarea"===n.input[r]||n.input[r].type&&"textarea"===n.input[r].type)i+="<label>"+r+':<textarea name="'+r+'" class="'+(n.input_classes&&n.input_classes[r]?n.input_classes[r]:"")+'" '+(a.placeholder?' placeholder="'+a.placeholder+'"':"")+">"+Xtion_html_special_chars(e[r])+"</textarea></label>";else if(n.input[r]instanceof Object){var c=n.input[r];for(s in i+="<label>"+r+':<select name="'+Xtion_html_special_chars(r)+'">',c)c.hasOwnProperty(s)&&(i+='<option value="'+Xtion_html_special_chars(s)+'"'+(s==e[r]?" selected":"")+">"+Xtion_html_special_chars(c[s])+"</option>");i+="</select></label>"}}else i+="<label>"+r.replace("_"," ")+':<input name="'+r+'" value="'+Xtion_html_special_chars(e[r])+'" type="'+(n.input_types&&n.input_types[r]||"text")+'" class="'+(n.input_classes&&n.input_classes[r]?n.input_classes[r]:"")+'"/></label>';else if(e[r]instanceof Object){var s,c=e[r];for(s in i+="<label>"+r+':<select name="'+Xtion_html_special_chars(r)+'">',c)c.hasOwnProperty(s)&&(i+='<option value="'+Xtion_html_special_chars(s)+'">'+Xtion_html_special_chars(c[s])+"</option>");i+="</select></label>"}o.innerHTML+=i;t=document.createElement("input");t.type="submit",o.appendChild(t);t=new XtionForm;return t.form=o,t.output=o.querySelector(".Xtion_form_output"),t.success_false_function=n.success_false_function,t.success_true_function=n.success_true_function,t.success_true_refresh=n.success_true_refresh,t.Initialize(),o}function Xtion_json_to_inputs_hidden(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&"string"==typeof e[t]&&(n+='<input name="'+t+'" value="'+Xtion_html_special_chars(e[t])+'" type="hidden"/>');return n}function Xtion_form_fill(e,t,n){for(var o=e.elements,r=(n=n||{}).exclude||{submit:1,button:1,hidden:1},i=o.length;i--;)r[o[i].type]||(o[i].multiple&&t[o[i].name]instanceof Array?o[i].options.forEach(function(e){~t[o[i].name].indexOf(e.value)&&(e.selected=!0)}):(o[i].value=t[o[i].name]||"",o[i].onchange&&o[i].onchange()))}function Xtion_form_disable(e,t){for(var n=e.elements||e.querySelectorAll("input,textarea,select"),o=0,r=n.length;o<r;o++)n[o].disabled=!t}function Xtion_url_parameters(e){if(e=void 0===e?location.search:e){~e.indexOf("?")?(e=e.split("?"))[1]&&(e[0]=e[1]):e=[e],~e[0].indexOf("#")&&(e[0]=e[0].split("#")[0]);var e=e[0].split("&"),t={};return e.forEach(function(e){e=e.split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"").replace(/\+/g," ")}),JSON.parse(JSON.stringify(t))}}function Xtion_query_parameters(e){return Xtion_url_parameters(e)}function Xtion_uri_query_parameters(e){return Xtion_url_parameters(e)}function Xtion_url_parameters_flatten(e,t){var n,o,r,i=[];for(n in e)e.hasOwnProperty(n)&&(o=t?t+"["+n+"]":n,r=e[n],i.push("object"==typeof r?Xtion_url_parameters_flatten(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r)));return i.join("&")}function Xtion_url_parameter_set(e,t){var n,o=t&&1!=t?t:location.href,r=Xtion_url_parameters(o);for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return o=o.split("?")[0]+"?"+Xtion_url_parameters_flatten(r),1==t&&(location.href=o),o}function Xtion_equality(e,t){if(e instanceof Array&&t instanceof Array){if(!e||!t||e.length!=t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!Xtion_equality(e[n],t[n]))return!1}else if(e[n]!=t[n])return!1;return!0}return console.error("Xtion_equality Non-Arrays Not Yet Supported"),!1}function Xtion_this_script(){return document.scripts[document.scripts.length-1]}function Xtion_script(e,t){var n=document.querySelector('script[src="'+e+'"]');n?t&&n.addEventListener("load",function(e){t(e)}):((n=document.createElement("script")).src=e,t&&n.addEventListener("load",function(e){t(e)}),(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(n,e))}function Xtion_elements_delete(e){if(e)for(var t=(e=e.tagName?[e]:e).length;t--;)e[t].parentNode.removeChild(e[t])}function Xtion_form_reset(e){e.reset();for(var t=e.querySelectorAll("select"),n=0;n<t.length;n++)t[n].onchange&&t[n].onchange()}function Xtion_object_key_delete(e,t){for(var n in e)~t.indexOf(n)&&delete e[n];return e}function Xtion_string_between(t,n,e,o,r,i){var a=t[o?"lastIndexOf":"indexOf"](n,i||void 0);if(~a){var c=-1;if((e instanceof Array?e:[e]).forEach(function(e){e=t.substr(a+n.length).indexOf(e);~e&&(c=-1===c||e<c?e:c)}),~c){i=t.substr(a+n.length,c);if(!r||""!==i)return i}}return r&&t[o?"lastIndexOf":"indexOf"](n,a+(o?-1:1))?Xtion_string_between(t,n,e,o,r,a+(o?-1:1)):""}function Xtion_image_url_data(e,t){var n=new Image;n.crossOrigin="anonymous",n.src=e;var o=0;n.onload=function(){o||(o=1,window.canvas=document.createElement("canvas"),canvas.width=n.naturalWidth,canvas.height=n.naturalHeight,canvas.getContext("2d").drawImage(n,0,0),t(canvas.toDataURL()))}}function Xtion_image_url_data_xhr(t,n){var o=new XMLHttpRequest;o.open("get",t,!0),o.responseType="arraybuffer",o.send(),o.onreadystatechange=function(){var e;4===o.readyState&&200===o.status&&((e=new FileReader).onload=function(e){n(e.target.result)},e.readAsDataURL(new Blob([o.response],{type:~t.indexOf(".png")?"image/png":"image/jpg"})))}}function Xtion_key_whitelist(t,e){var n={};return e.forEach(function(e){t[e]&&(n[e]=t[e])}),n}function Xtion_string_contains(t,e){if("string"==typeof e)return!!~t.indexOf(e);if(e instanceof Array){var n=!1;return e.forEach(function(e){~t.indexOf(e)&&(n=!0)}),n}console.log("Xtion_string_contains invalid type: "+typeof e)}function Xtion_elements_contain(e,t,n,o){var r=[];return Xtion_foreach(t instanceof Array?t:[t],function(t){Xtion_foreach(e,function(e){(o?e[n?"innerHTML":"textContent"]===t:RegExp(t).test(e[n?"innerHTML":"textContent"]))&&r.push(e)})}),r}function Xtion_foreach(e,t,n){if(e)if(e.constructor===Array)for(var o=0;o<e.length;o++)t(e[o],o,n instanceof Array?n:[]),n&&"object"==typeof e[o]&&Xtion_foreach(e[o],t,n instanceof Array?n.concat([o]):[o]);else for(var r in e)e.hasOwnProperty(r)&&(t(e[r],r,n instanceof Array?n:[]),n&&"object"==typeof e[r]&&Xtion_foreach(e[r],t,n instanceof Array?n.concat([r]):[r]))}function Xtion_parents(e,t,n){if(n=n||{},"number"==typeof t){for(;t--;)e=e.parentNode;return e}if(n.contains){for(;e.parentNode&&e.parentNode.parentNode;){if(e.parentNode.parentNode.querySelector(t))return n.get_selector?e.parentNode.parentNode.querySelector(t):e.parentNode.parentNode;e=e.parentNode}return null}for(;e.parentNode&&e.parentNode.parentNode;){if(~[].indexOf.call(e.parentNode.parentNode.querySelectorAll(t)||[],e.parentNode))return e.parentNode;e=e.parentNode}return null}function Xtion_element_coordinates(e,t){var n=e.getBoundingClientRect(),o=document.body,r=document.documentElement,i=t?0:window.pageYOffset||r.scrollTop||o.scrollTop,e=t?0:window.pageXOffset||r.scrollLeft||o.scrollLeft,t=r.clientTop||o.clientTop||0,o=r.clientLeft||o.clientLeft||0;return{top:Math.round(n.top+i-t),left:Math.round(n.left+e-o)}}function Xtion_time_ago(e){var t,n;r=isNaN(e)?(r=new Date,t=new Date(r.getFullYear(),0,1),n=new Date(r.getFullYear(),6,1),r=r.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),n.getTimezoneOffset()),new Date(Date.parse(e.replace(" ","T")+"-0"+(r?"7":"8")+"00"))):new Date(1e3*e);var o,e=864e5,r=new Date-r;return r<6e4?(o=Math.round(r/1e3))+" second"+(1==o?"":"s")+" ago":r<36e5?(o=Math.round(r/6e4))+" minute"+(1==o?"":"s")+" ago":r<e?(o=Math.round(r/36e5))+" hour"+(1==o?"":"s")+" ago":r<2592e6?(o=Math.round(r/e))+" day"+(1==o?"":"s")+" ago":r<31536e6?(o=Math.round(r/2592e6))+" month"+(1==o?"":"s")+" ago":(o=Math.round(r/31536e6))+" year"+(1==o?"":"s")+" ago"}function Xtion_indexesof(e,t){for(var n=[],o=0;o<e.length;o++)e[o]===t&&n.push(o);return n}function Xtion_instr(e,t){if(e){if(!(t instanceof Array))return!!~e.indexOf(t);for(var n=0;n<t.length;n++)if(~e.indexOf(t[n]))return!0}return!1}function Xtion_xpath_element(e,t){return document.evaluate(e,t||document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}function Xtion_xpath_elements(e,t){for(var n=[],o=document.evaluate(e,t||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=0,i=o.snapshotLength;r<i;++r)n.push(o.snapshotItem(r));return n}function Xtion_clipboard_copy(e){if(navigator.clipboard)navigator.clipboard.writeText(e).then(function(){},function(e){console.error("Async: Could not copy text: ",e)});else{var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}}function Xtion_object_indexes(n){var o=!1,r=0,i=arguments;return Xtion_foreach(i,function(e,t){0==t||r||(e instanceof Array?(n=Xtion_object_indexes.apply(null,[n].concat(e)))?t==i.length-1&&(o=!0):r=1:n[e]?(n=n[e],t==i.length-1&&(o=!0)):r=1)}),!!o&&n}function Xtion_object_indexes_flexible(n){var o=!1;return Xtion_foreach(arguments,function(e,t){0!=t&&n[e]&&(n=n[e],t==arguments.length-1&&(o=!0))}),!!o&&n}function Xtion_request(t,n,r){r="string"==typeof r?{post:r}:r||{};var o=Object.assign({},r),e=document.getElementsByTagName("html")[0].style;e.cursor="progress";var i,a=null;if(r.loading_overlay&&(a=Xtion_popup_loading()),r.method=r.method||(r.post||r.files?"POST":"GET"),r.async=void 0===r.async||r.async,r.files){if(r.data=new FormData,r.post)if("string"==typeof r.post&&(r.post=Xtion_url_parameters(r.post)),"object"==typeof r.post)for(var c in r.post)r.post.hasOwnProperty(c)&&r.data.append(c,r.post[c]);else console.log("Request Post data is invalid");for(var c in r.files)r.files.hasOwnProperty(c)&&r.data.append(c,r.files[c])}else r.post&&"object"==typeof r.post&&(r.data||(r.data=r.post instanceof HTMLElement?new FormData(r.post):new FormData),r.post instanceof HTMLElement||(i=function(e,t){for(var n in e){var o;e.hasOwnProperty(n)&&(o=t?t+"["+n+"]":"",e[n]===Object(e[n])?i(e[n],o||n):r.data.append(o||n,e[n]))}})(r.post));xtion.csrf&&(d=encodeURIComponent(xtion.csrf),r.data?r.data.append("_t",d):r.post?r.post+="&_t="+d:t+=(~t.indexOf("?")?"&":"?")+"_t="+d);var s,p=new XMLHttpRequest,l=(new Date).getTime();if(p.open(r.method||"GET",t,r.async),r.retry&&(s=r.error?r.error.bind():function(){},r.error=function(e){r.retry_count=r.retry_count?r.retry_count+1:1,r.retry_count<=r.retry?setTimeout(function(){Xtion_request(t,n,Object.assign(o,{retry_count:r.retry_count}))},"timeout"===e?0:r.retry_delay||1e3*r.retry_count*2):s(e)}),!r.post||r.data||r.files||r.headers&&r.headers["content-type"]||p.setRequestHeader("content-type","application/x-www-form-urlencoded"),r.headers)for(var u in r.headers)r.headers.hasOwnProperty(u)&&p.setRequestHeader(u,r.headers[u]);if(r.timeout&&(p.timeout=r.timeout),r.error&&(p.ontimeout=function(){a&&a.close(),e.cursor="",r.error("timeout"),console.log("Request Timeout ("+((new Date).getTime()-l)/1e3+"s)")}),r.response_type&&(p.responseType=r.response_type),r.xhr)for(var _ in r.xhr)p[_]=r.xhr[_];p.send(r.data||r.post);var d=function(){4===p.readyState&&(a&&a.close(),e.cursor="",200===p.status||r.any_status?n&&("function"==typeof n?n(r.response_full?p:"blob"===r.response_type?p.response:p.responseText):"object"==typeof n&&(n.innerHTML=p.responseText)):(r.error&&r.error(p.status),console.log("Request Failed Status "+p.status)))};return r.async?p.onreadystatechange=d:d(),p}function Xtion_request_action(e,t,n){xtion.Xtion_request_action_api&&((n=n||{}).post=n.post?Xtion_object_merge(n.post,{api:xtion.Xtion_request_action_api}):{api:xtion.Xtion_request_action_api}),Xtion_request(LOCATION_ACTION+e,t,n)}function Xtion_request_out_save(e){1!=e&&(alert("Error: "+e),console.error(e))}function Xtion_request_out_save_refresh(e,t){1==e?(t?window.top:window).location.reload():(alert("Error: "+e),console.error(e))}function Xtion_request_out_save_refresh_top(e){Xtion_request_out_save_refresh(e,1)}function Xtion_request_out_save_function(e,t){1==e?t():(alert("Error: "+e),console.error(e))}function Xtion_request_out_alert(e){alert(e)}function Xtion_request_out_updated(e){1==e?alert("Updated"):(alert("Error: "+e),console.error(e))}var Xtion_popups=[];function Xtion_popup(e,t){t=Xtion_object_merge(t,xtion.Xtion_popup);var n,o,r=e,i=t.target||window,a=t.target?t.target.document:document;if(e&&"object"==typeof e&&e.classList&&e.classList.contains("Xtion_popup_use")){if(e.style.display="",t.info_input)for(var c in t.info||(t.info=""),t.info_input)t.info+='<input type="hidden" name="'+Xtion_html_special_chars(c)+'" value="'+Xtion_html_special_chars(t.info_input[c])+'"/>';t.info&&((l=e.getElementsByClassName("Xtion_popup_content_info"))[0]?l[0].innerHTML=t.info:console.error("Xtion_popup No Info Element")),t.form_reset&&(l=e.getElementsByTagName("form"))&&Xtion_form_reset(l[0]),t.form_fill&&(l=e.getElementsByTagName("form"))&&Xtion_form_fill(l[0],t.form_fill);var s=a.querySelectorAll("body>div.Xtion_popup_container").length;s&&(e.style.zIndex=1e4+s),(l=e.getElementsByClassName("Xtion_popup_content")).length&&(l[0].scrollTop=0)}else{t.group&&(n=(n=t.group.group[t.group.position-1])||t.group.group[t.group.group.length-1],t.previous=a.createElement("button"),t.previous.innerHTML="&#8678;",t.previous.onclick=function(){this.parentNode.parentNode.parentNode.previousSibling.onclick(),Xtion_popup(n.content,n.options_popup)},o=(o=t.group.group[t.group.position+1])||t.group.group[0],t.next=a.createElement("button"),t.next.innerHTML="&#8680;",t.next.onclick=function(){this.parentNode.parentNode.parentNode.previousSibling.onclick(),Xtion_popup(o.content,o.options_popup)}),r=a.createElement("div"),t.id&&(r.id=t.id),r.className="Xtion_popup_container"+(t.container_classes?" "+t.container_classes:""),t.container_click&&r.addEventListener("click",t.container_click),a.body.appendChild(r),0!==t.overlay&&((p=a.createElement("div")).className="Xtion_popup_overlay",0!==t.overlay_close&&(p.onclick=function(){t.overlay_click&&t.overlay_click(),i.Xtion_popup_close(this.parentNode)}),r.appendChild(p)),(s=a.createElement("div")).className="Xtion_popup_content_container";var s=r.appendChild(s),p=a.createElement("div");p.className="Xtion_popup_content"+(t.content_class?" "+t.content_class:""),t.width&&(p.style.width=t.width+"px"),e.substr&&"http"===e.substr(0,4)&&(e='<iframe src="'+e+'"></iframe>'),p=s.appendChild(p),"object"!=typeof e||1!==e.nodeType&&11!==e.nodeType?p.innerHTML+=e:p.appendChild(e),t.next&&content_actions.insertBefore(t.next,content_actions.firstChild),t.previous&&content_actions.insertBefore(t.previous,content_actions.firstChild),t.xtion_detect&&Xtion_detect(p)}var l,p=["Xtion_popup_showing"].concat(t.body_classes?t.body_classes instanceof Array?t.body_classes:t.body_classes.split(" "):[]);p.forEach(function(e){a.body.classList.add(e)}),(l=r.querySelector("[data-xtion-focused]"))&&l.focus(),xtion.hook&&xtion.hook.Xtion_popup&&xtion.hook.Xtion_popup.end&&xtion.hook.Xtion_popup.end();p={container:r,body_classes:p,close:function(){i.Xtion_popup_close(r)}};return i.Xtion_popups.push(p),p}function Xtion_popup_close(t){if(!t)if(Xtion_popups.length)t=Xtion_popups[Xtion_popups.length-1];else for(var e=document.getElementsByClassName("Xtion_popup_container"),n=e.length;n--;)if(!e[n].style.display){t=e[n];break}if(t){var o=t.container||t,r={body_classes:["Xtion_popup_showing"]};for(Xtion_popups.forEach(function(e){e.container===t&&(r=e)}),o.classList.contains("Xtion_popup_use")?o.style.display="none":o.parentNode.removeChild(o),r.body_classes.forEach(function(e){document.body.classList.remove(e)}),Xtion_popup_event(o,"close");~Xtion_popups.indexOf(t);)Xtion_popups.splice(Xtion_popups.indexOf(t),1)}}function Xtion_popups_close(){for(var t=document.getElementsByClassName("Xtion_popup_container"),n=t.length;n--;){var o={body_classes:[]};Xtion_popups.forEach(function(e){e.container===t[n]&&(o=e)}),o.body_classes.forEach(function(e){document.body.classList.remove(e)}),t[n].classList.contains("Xtion_popup_use")?t[n].style.display="none":t[n].parentNode.removeChild(t[n]),Xtion_popup_event(t[n],"close")}document.body.classList.remove("Xtion_popup_showing"),window.Xtion_popups_close_extend&&window.Xtion_popups_close_extend(),Xtion_popups=[]}function Xtion_popup_event(e,t){e&&("close"===t?((t=e.getAttribute("data-xtion-close"))&&new Function("e",t)(e),(t=e.getElementsByClassName("Xtion_popup_content_info"))[0]&&(t[0].innerHTML=""),e.style.zIndex=""):console.error("Xtion_popup_event Invalid"))}function Xtion_popup_alert(e){"string"==typeof e&&(e={message:e});var t,n=document.createDocumentFragment();e.title&&((t=document.createElement("h1")).innerHTML=e.title,n.appendChild(t)),e.message&&(r=document.createElement("p"),"object"!=typeof(o=e.message)||1!==o.nodeType&&11!==o.nodeType?r.innerHTML+=o:r.appendChild(o),n.appendChild(r));var o=document.createElement("div");o.className="Xtion_popup_actions",n.appendChild(o);var r=document.createElement("button");r.style.width="100%",r.innerHTML="Okay",r.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),Xtion_popup_close(this.parentNode.parentNode.parentNode.parentNode),!1}),o.appendChild(r),Xtion_popup(n,{container_classes:"Xtion_popup_alert_container"})}function Xtion_popup_confirm(e,t){if(null!==e){e="string"==typeof e?{message:e}:Xtion_object_merge(e,Xtion_object_merge(xtion.Xtion_popup_confirm,xtion.Xtion_popups));var n,o=document.createDocumentFragment();e.title&&((n=document.createElement("h1")).innerHTML=e.title,o.appendChild(n)),e.message&&((n=document.createElement("p")).innerHTML=e.message,o.appendChild(n));var r=document.createElement("div");if(r.className="Xtion_popup_content_actions",o.appendChild(r),e.actions_extra?(e.actions_extra.unshift(e.actions_okay||"Okay"),e.actions_extra.push(e.actions_cancel||"Cancel")):e.actions_extra=[e.actions_okay||"Okay",e.actions_cancel||"Cancel"],e.actions_extra)for(var i=0;i<e.actions_extra.length;i++){var a=document.createElement("button");a.setAttribute("data-action",i===e.actions_extra.length-1?0:i+1),a.innerHTML=e.actions_extra[i],a.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),Xtion_popup_close(this.parentNode.parentNode.parentNode.parentNode),t(parseInt(this.getAttribute("data-action")),e),!1}),r.appendChild(a)}Xtion_popup(o,{container_classes:"Xtion_popup_confirm_container",cancel_callback:e.cancel_callback})}else t(1)}function Xtion_popup_prompt(e,t,n){n=n||{};var o=e.type||n.type,r=document.createElement("form");r.action="javascript:",(i=document.createElement("div")).className="Xtion_popup_prompt_inputs";var i=r.appendChild(i);(a=document.createElement("label")).innerHTML=e.label||e;var a=i.appendChild(a),c=document.createElement("textarea"===o?"textarea":"select"===o?"select":"input"),c=a.appendChild(c);"string"!=typeof t&&"number"!=typeof t||(c.value=t),"string"!=typeof n&&"number"!=typeof n||(c.value=n),n.value&&(c.value=n.value),(a=document.createElement("div")).className="Xtion_popup_prompt_actions";var a=r.appendChild(a),s=document.createElement("button");s.innerHTML="Ok",s.onclick=function(){"function"==typeof t&&t(c.value),this.nextSibling.onclick()},a.appendChild(s),c.addEventListener("keydown",function(e){10!=e.keyCode&&13!=e.keyCode||!e.ctrlKey||s.onclick()});var p=Xtion_popup(r,Xtion_object_merge(n.popup||{},{container_classes:"Xtion_popup_prompt"})),n=document.createElement("button");return n.innerHTML="Cancel",n.onclick=function(e){p.close()},a.appendChild(n),c.focus(),p}function Xtion_prompt(e,t,n){return Xtion_popup_prompt(e,t,n)}function Xtion_popup_prompt_form(e,t,n){var o=Xtion_popup(Xtion_json_to_form(e,function(e){o.close(),t(e)},n=n||{}),Xtion_object_merge(n.popup||{},{container_classes:"Xtion_popup_prompt_form"}));return o}function Xtion_popup_select(e,r,i){i=i||{};var t,a=document.createDocumentFragment();return i.header&&((t=document.createElement("header")).innerHTML=i.header,a.appendChild(t)),Xtion_foreach(e,function(e,t){e instanceof Object&&(t=void 0!==e[i.key||"key"]?e[i.key||"key"]:t,e=void 0!==e[i.value||"value"]?e[i.value||"value"]:e);var n=document.createElement("div");n.setAttribute("data-xtion-value",t);var o=document.createElement("a");o[i.html?"innerHTML":"textContent"]=e,n.appendChild(o),i.suffix&&(n.innerHTML+=i.suffix),n.onclick=function(){r(t,this.textContent),n.offsetParent&&!i.noclose&&Xtion_popup_close(Xtion_parents(n,".Xtion_popup_container"))},a.appendChild(n)}),Xtion_popup(a,Xtion_object_merge(i.popup||{},{container_classes:"Xtion_popup_select"}))}function Xtion_popup_loading(e){e=e||{};var t,n=document.createElement("div");return(e.loading||xtion.loading)&&(n.innerHTML=e.loading||xtion.loading),e.message&&(n.innerHTML+="<p>"+e.message+"</p>"),e.cancel&&((t=document.createElement("button")).innerHTML="Cancel",t.onclick=e.cancel,n.appendChild(t)),Xtion_popup(n,Xtion_object_merge(e.popup||{},{overlay_close:0,container_classes:"Xtion_popup_loading_container"}))}function Xtion_popup_temporary(e,t){var n=Xtion_popup(e,Xtion_object_merge({container_classes:"Xtion_popup_temporary_container"+((t="number"==typeof t?{time:t}:t||{}).class?" "+t.class:""),overlay:0},t));setTimeout(function(){n.container.classList.add("Xtion_popup_temporary_container_animation")},50),setTimeout(function(){n.close()},t.time||5e3)}
