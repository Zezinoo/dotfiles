!function(){function l(e,t){function n(e,t){return t<(e=parseInt(e,10).toString(16)).length?e.slice(e.length-t):t>e.length?Array(t-e.length+1).join("0")+e:e}return void 0===e&&(e=""),this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,e=e,e=(e+=n(parseInt((new Date).getTime()/1e3,10),8))+n(this.php_js.uniqidSeed,5),t&&(e+=(10*Math.random()).toFixed(8).toString()),e}window.emailtracker_detector=l();var h=window.emailtracker_detector,u=fetch,e=(window.fetch=function(e,a){if(window.emailtracker_detector!==h)return u.apply(this,arguments);var t,n,r,d,i,p=arguments,o=e&&e.url?e.url:e;try{if(!o||!o.indexOf)return u.apply(this,arguments);if(!((~o.indexOf("action=CreateItem")||~o.indexOf("action=UpdateItem"))&&top.document.documentElement.getAttribute("data-emailtracker-initialized")&&a&&a.body))return~o.indexOf("action=FindItem")&&top.document.documentElement.getAttribute("data-emailtracker-initialized")&&a&&a.headers&&(t=a.headers.get("x-owa-urlpostdata"))&&(n=JSON.parse(decodeURIComponent(t)),r={__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"6edab709-7fed-4c7a-a77e-33831fd504cf",PropertyName:"emailtracker_idv",PropertyType:"String"},d=~o.indexOf("action=FindConversation")?"ConversationShape":"ItemShape",n.Body)&&n.Body[d]&&(n.Body[d].AdditionalProperties?n.Body[d].AdditionalProperties.push(r):n.Body[d].AdditionalProperties=[r],a.headers.set("x-owa-urlpostdata",encodeURIComponent(JSON.stringify(n))),p[1]=a),(i=u.apply(this,p)).then(function(e){var t=a?a.headers&&a.headers.get&&a.headers.get("x-owa-urlpostdata")||a.body:"";return(~e.url.indexOf("action=FindItem")||~e.url.indexOf("action=FindConversation")&&~t.indexOf("ReactConversationSentItemsListView"))&&e.clone().text().then(function(e){document.dispatchEvent(new CustomEvent("emailtracker_items",{detail:{body:e}}))}),e}),i;try{var s,c,y=JSON.parse(a.body);return"SendAndSaveCopy"===y.Body.MessageDisposition?(s=this,c="emailtracker_send"+l(),top.document.dispatchEvent(new CustomEvent("emailtracker_send",{detail:{sid:c,post:y}})),new Promise(function(r,e){function t(){o++,n()?d():o<=i.retries?setTimeout(t,i.delay):i.callback_timeout&&i.callback_timeout()}var n,d,i,o;n=function(){return top[c]},d=function(){-1!==top[c]&&(t={__type:"ExtendedPropertyType:#Exchange",Value:top[c].id_tracking,ExtendedFieldURI:{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"0f593b63-959d-4095-910c-c7dfe59ce739",PropertyName:"emailtracker_id",PropertyType:"String"}},e={__type:"ExtendedPropertyType:#Exchange",Value:top[c].id_tracking+"_"+top[c].id_tracking_v,ExtendedFieldURI:{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"6edab709-7fed-4c7a-a77e-33831fd504cf",PropertyName:"emailtracker_idv",PropertyType:"String"}},y.Body.Items?(y.Body.Items[0].Body?y.Body.Items[0].Body.Value=top[c].body:y.Body.Items[0].NewBodyContent&&(y.Body.Items[0].NewBodyContent.Value=top[c].body),Array.isArray(y.Body.Items[0].ExtendedProperty)||(y.Body.Items[0].ExtendedProperty=[]),y.Body.Items[0].ExtendedProperty.push(t),y.Body.Items[0].ExtendedProperty.push(e)):((n=y.Body.ItemChanges[0].Updates).forEach(function(e,t){e.Item&&e.Item.Body&&(n[t].Item.Body.Value=top[c].body)}),n&&(n.push({__type:"SetItemField:#Exchange",Item:{__type:"Message:#Exchange",ExtendedProperty:[t]},Path:t.ExtendedFieldURI}),n.push({__type:"SetItemField:#Exchange",Item:{__type:"Message:#Exchange",ExtendedProperty:[e]},Path:e.ExtendedFieldURI}))),a.body=JSON.stringify(y));var e,n,t=u.apply(this,p);t.then(function(t){return t.clone().text().then(function(e){document.dispatchEvent(new CustomEvent("emailtracker_sent"+c,{detail:{response:e,headers:new Map(t.headers.entries())}}))}),t}),r(t)},(i=(i={retries:10,callback_timeout:function(){u.apply(s,p)}})||{}).delay=i.delay||500,i.retries=i.retries||30,o=0,t()})):u.apply(this,arguments)}catch(e){return console.error(e),u.apply(this,arguments)}}catch(e){return u.apply(this,arguments)}},XMLHttpRequest.prototype),n=e.open,t=e.send;e.open=function(e,t){return this._url=t,n.apply(this,arguments)},e.send=function(e){return window.emailtracker_detector===h&&this.addEventListener("load",function(){}),t.apply(this,arguments)}}();
